<!doctype html>
<html lang="en">
<head>
    <title>Chemistry test 03</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <meta name="google-site-verification" content="nIR8x7LZFABWl5bZLRxEDImGFoRx8nPfqsEGpkBXPa4" />
    <meta name="msvalidate.01" content="E67DB0033A5C70404D00E757E69CF820" />
    <meta name="yandex-verification" content="7212c07f61a8933e" />




    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/XXSDH9QH/Techniox-1.png">
    <link rel="stylesheet" href="https://www.selfstudys.com/viewncert/design-april-2022/css/bootstrap.min.css" type="text/css">

    <link rel="stylesheet" href="https://www.selfstudys.com/viewncert/design-april-2022/css/style.css?a=25" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap">

    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "@id": "https://www.selfstudys.com/#organization",
            "name": "SelfStudys",
            "url": "https://www.selfstudys.com/",
            "sameAs": [
                "https://t.me/selfstudys_ncert_solutions",
                "https://www.facebook.com/selfstudys",
                "https://www.youtube.com/channel/UCxzwsmOwFkn1JFrP7Oh60ag",
                "https://twitter.com/self_studys",
                "https://www.linkedin.com/company/selfstudys",
                "https://in.pinterest.com/selfstudys/"
            ],
            "logo": {
                "@type": "ImageObject",
                "@id": "https://www.selfstudys.com/#logo",
                "inLanguage": "en-US",
                "url": "https://www.selfstudys.com/viewncert/design-april-2022/images/logo.png",
                "contentUrl": "https://www.selfstudys.com/viewncert/design-april-2022/images/logo.png",
                "width": 169,
                "height": 59,
                "caption": "SelfStudys"
            },
            "image": {
                "@id": "https://www.selfstudys.com/#logo"
            }
        }
    </script>

    <style>

    </style>


    <meta name="robots" content="noindex, nofollow" />

    <link rel="canonical" href="https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209"/>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta property="og:keywords" content="" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@self_studys">
    <meta name="twitter:title" content="Physics Test 209">
    <meta name="twitter:description" content="">

    <meta property="og:title" content="Physics Test 209" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209" />
    <meta property="og:image" content="https://www.selfstudys.com/uploads/external-images/selfstudy_og_img_1200_628.png" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="SelfStudys" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="628" />
</head>

<body onselectstart="return false">
<div id="loader-wrapper" class="hideThis"><div id="loader"><img src="https://www.selfstudys.com/viewncert/design-april-2022/images/icons/loading-test.gif" ></div></div>


<header class="pb-3 pt-1">
    <div class="container" id="siteHeaderContainer">
        <div class="d-flex flex-wrap align-items-center justify-content-sm-between">




            <div id="headerLoginProfile">
                <div class="text-end d-flex align-items-center loginHeaderBtn hideThis" id="headerLoginBtnDiv">
                    <a href="javascript:void(0)" class="me-2 d-none-mobile user-sign showLoginPopup" data-source="header">
                        <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/usericon.svg" alt=""> Sign in
                    </a>
                    <button type="button" class="user-signup d-none-mobile btn btn-primary showLoginPopup" data-source="header">Sign up</button>
                    <a href="javascript:void(0)" class="d-none d-block-mobile login-mobile showSignupPopup" data-source="header"><img src="https://www.selfstudys.com/viewncert/design-april-2022/images/user-icon.svg" alt="" style="width: 28px; height: 28px;"></a>
                </div>
                <div class="text-end d-flex align-items-center hideThis" id="headerProfileDiv">
                    <div class="profile-area">
                        <div class="dropdown">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/icons/header-profile-icon.png" alt="" class="user-icon">
                                <span class="profileUName d-none-mobile" id="headerUserName"></span>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                <li><a class="dropdown-item" href="https://www.selfstudys.com/user/profile"><img src="https://www.selfstudys.com/viewncert/design-april-2022/images/profile-user.svg" alt="">Profile</a></li>
                                <li><a class="dropdown-item" href="javascript:void(0)" onclick="logoutUser(1)"><img src="https://www.selfstudys.com/viewncert/design-april-2022/images/profile-signout.svg" alt="">Signout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>





<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>

            <li class="breadcrumb-item"><a href="exa.html">All Test</a></li>
            <li class="breadcrumb-item active" aria-current="page">Chemistry set 03</li>
        </ol>
    </nav>
</div>
<div class="container head-info mt-3 mb-3">
    <div class="row justify-content-sm-between">
        <div class="col-12 col-md-7 col-lg-7 ft-lora">
            <h1>Chemistry set 03</h1>
        </div>
    </div>
</div>
</section>

<section class="pt-4 pb-5 bg-very-light page-detail mt-3">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-7 col-lg-7 me-auto question-box">
                <div class="time-left">
                    <i class="bi bi-alarm"></i> <span class="ms-3">TIME LEFT - <span id="timeLeftSpanId"></span></span>
                </div>
                <form id="quiz">
                    <ul class="ques-list">
                        <li id="question-1077433">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 1</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>Ecell of the following cell is Pt(s) IH2(g), 1bar IH+ (1 M) II H+ (0.1 M) I H2 (g), 1 bar IPt(s)</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077433" id="question-1077433-option1" value="A">
                                        <label for="question-1077433-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>(-2.303RT)/F</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077433" id="question-1077433-option2" value="B">
                                        <label for="question-1077433-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>2.303RT/F</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077433" id="question-1077433-option3" value="C">
                                        <label for="question-1077433-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>(-2.303RT)/2F</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077433" id="question-1077433-option4" value="D">
                                        <label for="question-1077433-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>2.303RT/2F</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077433" value="<p>a</p>"/>
                        <li id="question-1077434">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 2</h6><span>4 / -1</span>
                            </div>

                            <div class="qhscrol">
                                <p><p>In a lead-acid battery, if 1 A current is passed to charge the battery for 1 h, what is the amount of PbS04  converted to PbO2? (Given data:  1 F = 96500 C mol^-1</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077434" id="question-1077434-option1" value="A">
                                        <label for="question-1077434-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>0.0373 moles</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077434" id="question-1077434-option2" value="B">
                                        <label for="question-1077434-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>0.0093 moles</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077434" id="question-1077434-option3" value="C">
                                        <label for="question-1077434-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>0.0268 moles</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077434" id="question-1077434-option4" value="D">
                                        <label for="question-1077434-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>0.0186 moles</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077434" value="<p>d</p>"/>
                        <li id="question-1077435">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 3</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>A fuel cell operates at constant current, with  H2  fuel (1 bar) and 02 oxidant (1 bar). The electrolyte used is 0.00 1 M HCl and the product(s) of the reaction are confined inside the fuel cell. Which of the  following is true about the electrolyte?</p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077435" id="question-1077435-option1" value="A">
                                        <label for="question-1077435-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>Boiling point of the electrolyte decreases with increase in the duration of fuel cell operation</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077435" id="question-1077435-option2" value="B">
                                        <label for="question-1077435-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>Boiling point of the electrolyte increases with increase in the duration of fuel cell operation</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077435" id="question-1077435-option3" value="C">
                                        <label for="question-1077435-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>Open circuit voltage of the fuel cell remains constant with increase in duration of operation</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077435" id="question-1077435-option4" value="D">
                                        <label for="question-1077435-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>Open circuit voltage of the fuel cell increases with increase in- duration of operation</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077435" value="<p>a</p>"/>
                        <li id="question-1077436">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 4</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>The correct IUPAC name for methylisopropylacetylene is</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077436" id="question-1077436-option1" value="A">
                                        <label for="question-1077436-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>2-methyl-4-pentyne</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077436" id="question-1077436-option2" value="B">
                                        <label for="question-1077436-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>4-methyl-2-pentyne</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077436" id="question-1077436-option3" value="C">
                                        <label for="question-1077436-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>isopropylmethy lacetylene</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077436" id="question-1077436-option4" value="D">
                                        <label for="question-1077436-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>3-methyl-4-pentyne</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077436" value="<p>b</p>"/>
                        <li id="question-1077437">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 5</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>Cyclohexylamine and aniline can be distinguished by</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077437" id="question-1077437-option1" value="A">
                                        <label for="question-1077437-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>Hinsberg's test</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077437" id="question-1077437-option2" value="B">
                                        <label for="question-1077437-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>Bromine test</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077437" id="question-1077437-option3" value="C">
                                        <label for="question-1077437-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>Carbylamine test</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077437" id="question-1077437-option4" value="D">
                                        <label for="question-1077437-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>Beilstein's test</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077437" value="<p>b</p>"/>
                        <li id="question-1077438">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 6</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>The compounds pyridine and planar cyclooctatetraene are ----- respectively</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077438" id="question-1077438-option1" value="A">
                                        <label for="question-1077438-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>aromatic and non-arom atic</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077438" id="question-1077438-option2" value="B">
                                        <label for="question-1077438-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>aromatic and aromatic</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077438" id="question-1077438-option3" value="C">
                                        <label for="question-1077438-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>aromatic and anti-aromatic</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077438" id="question-1077438-option4" value="D">
                                        <label for="question-1077438-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>anti-aromatic and anti-aromatic</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077438" value="<p>c</p>"/>
                        <li id="question-1077439">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 7</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p> Propylene on treatment with HBr/H202 provides</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077439" id="question-1077439-option1" value="A">
                                        <label for="question-1077439-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>1,2-dibromopropane</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077439" id="question-1077439-option2" value="B">
                                        <label for="question-1077439-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>2-bromopropane</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077439" id="question-1077439-option3" value="C">
                                        <label for="question-1077439-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>1-bromopropa ne</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077439" id="question-1077439-option4" value="D">
                                        <label for="question-1077439-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>2-bromopropan-1-ol</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077439" value="<p>c</p>"/>
                        <li id="question-1077440">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 8</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>__is a potent vasodilator.</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077440" id="question-1077440-option1" value="A">
                                        <label for="question-1077440-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>Histamine</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077440" id="question-1077440-option2" value="B">
                                        <label for="question-1077440-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>Serotonin</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077440" id="question-1077440-option3" value="C">
                                        <label for="question-1077440-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>Codeine</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077440" id="question-1077440-option4" value="D">
                                        <label for="question-1077440-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>Cimetidine</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077440" value="<p>a</p>"/>
                        <li id="question-1077441">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 9</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>An invert sugar is</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077441" id="question-1077441-option1" value="A">
                                        <label for="question-1077441-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>Isorotatory</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077441" id="question-1077441-option2" value="B">
                                        <label for="question-1077441-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>Levorotatory</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077441" id="question-1077441-option3" value="C">
                                        <label for="question-1077441-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>Dextrorotatory</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077441" id="question-1077441-option4" value="D">
                                        <label for="question-1077441-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>Optially inactive</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077441" value="<p>b</p>"/>
                        <li id="question-1077442">
                            <div class="ques-no d-flex align-items-center mb-3">
                                <h6>Question 10</h6><span>4 / -1</span>
                            </div>


                            <div class="qhscrol">
                                <p><p>The strongest base among the following is</p></p>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077442" id="question-1077442-option1" value="A">
                                        <label for="question-1077442-option1" class="form-check-label d-flex align-items-center"><span class="optionIndex">A</span> <h6>CH3CH2^-</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077442" id="question-1077442-option2" value="B">
                                        <label for="question-1077442-option2" class="form-check-label d-flex align-items-center"> <span class="optionIndex">B</span> <h6>"NH2^-</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077442" id="question-1077442-option3" value="C">
                                        <label for="question-1077442-option3" class="form-check-label d-flex align-items-center"> <span class="optionIndex">C</span> <h6>OH^-</h6></label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <div class="qhscrol">
                                        <input class="form-check-input" type="radio" name="question-1077442" id="question-1077442-option4" value="D">
                                        <label for="question-1077442-option4" class="form-check-label d-flex align-items-center"><span class="optionIndex">D</span> <h6>CH=C^-</h6></label>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <input type="hidden" name="answer-1077442" value="<p>a</p>"/>
                    </ul>
                    <a class="submit-btn submitTest" href="javascript:void(0)">Submit Test</a>
                </form>
            </div>
            <div class="col-12 col-md-4 col-lg-4">
                <div id="mydiv">
                    <a href="#" class="app-popup" id="mydivheader" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/app-pop.svg" alt="">
                    </a>
                </div>
                <div class="applicant-area">
                    <button type="button" class="btn-close"> </button>
                    <div class="applicant-detail">
                        <img id="currUserProfilePic" src="https://www.selfstudys.com/viewncert/design-april-2022/images/user_profile_placeholder.png" class="userProfileImage rounded-circle img-thumbnail" style="height: 85px; width: 85px;">
                        <h5 id="currUserName">User</h5>
                    </div>
                    <div class="mcq-analysis mt-3">
                        <h5>Question Analysis</h5>
                        <div class="ana-detail">
                            <ul class="mb-3 attemps">
                                <li><span></span><p>Answered - <spna id="qAnsweredCount">0</spna></p></li>
                                <li><span></span><p>Unanswered - <spna id="qUnAnsweredCount">10</spna></p></li>
                            </ul>
                            <ul class="number-list row row-cols-5">
                                <li class="col not-done"><div id="qNavigator-1077433" class="ansMarkItem">1</div></li>
                                <li class="col not-done"><div id="qNavigator-1077434" class="ansMarkItem">2</div></li>
                                <li class="col not-done"><div id="qNavigator-1077435" class="ansMarkItem">3</div></li>
                                <li class="col not-done"><div id="qNavigator-1077436" class="ansMarkItem">4</div></li>
                                <li class="col not-done"><div id="qNavigator-1077437" class="ansMarkItem">5</div></li>
                                <li class="col not-done"><div id="qNavigator-1077438" class="ansMarkItem">6</div></li>
                                <li class="col not-done"><div id="qNavigator-1077439" class="ansMarkItem">7</div></li>
                                <li class="col not-done"><div id="qNavigator-1077440" class="ansMarkItem">8</div></li>
                                <li class="col not-done"><div id="qNavigator-1077441" class="ansMarkItem">9</div></li>
                                <li class="col not-done"><div id="qNavigator-1077442" class="ansMarkItem">10</div></li>
                            </ul>
                            <a class="submit-btn submitTest" href="javascript:void(0)">Submit Test</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>






<script src="https://www.selfstudys.com/viewncert/design-april-2022/js/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
<script src="https://www.selfstudys.com/viewncert/design-april-2022/js/bootstrap.bundle.min.js" async defer crossorigin="anonymous"></script>
<script src="https://www.selfstudys.com/viewncert/design-april-2022/js/custom.js?a=3" crossorigin="anonymous"></script>
<script src="https://www.selfstudys.com/viewncert/design-april-2022/js/localforage.min.js"></script>

<script>
    var loginSource = 'not_set';

    function isOldEnough(dataWithTimestamp, seconds) {
        const milliSeconds = seconds * 1000;
        const currentTime = new Date().getTime();
        if (!dataWithTimestamp.timestamp) return true;
        return currentTime - dataWithTimestamp.timestamp > milliSeconds;
    }

    function performGETRequest(getUrl, payload, addMetaData) {
        //payload must be of obj type: payload = {'key': 'value'};
        if(addMetaData) { payload.application_id  = 'com.selfstudys'; payload.app_version = 1; payload.uuid = getUserUUID(); payload.page = "https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209"; payload.device_type = 2; }
        return new Promise((resolve, reject) => {
            $.ajax({ method: "GET", url: getUrl, dataType: 'json', data: payload })
                .done(function(data) { resolve(data); })
                .fail(function( jqXHR, textStatus, errorThrown ) {
                    var errorMessage = "Failed GET Request for: " + getUrl;
                    if (jqXHR.status) {
                        errorMessage += "; Status: " + jqXHR.status;
                    }

                    // if (jqXHR.responseText) {
                    //     errorMessage += "; ResponseText: " + jqXHR.responseText;
                    // }

                    if (jqXHR.responseJSON && jqXHR.responseJSON.error) {
                        if (jqXHR.responseJSON.error.title) {
                            errorMessage += "; Title: " + jqXHR.responseJSON.error.title;
                        }
                        if (jqXHR.responseJSON.error.message) {
                            errorMessage += "; Message: " + jqXHR.responseJSON.error.message;
                        }
                    } else if (textStatus) {
                        errorMessage += "; TextStatus: " + textStatus;
                    } else if (errorThrown) {
                        errorMessage += "; ErrorThrown: " + errorThrown;
                    } else {
                        errorMessage += "; An unknown error occurred";
                    }

                    // try {
                    //     var jqXHRString = JSON.stringify(jqXHR);
                    //     errorMessage += "; jqXHR: " + jqXHRString;
                    // } catch (e) {
                    //     errorMessage += "; Error serializing jqXHR: " + e.message;
                    // }

                    reject(errorMessage);
                });
        });
    }

    function performPOSTRequest(postUrl, payload, addMetaData) {
        //payload must be of obj type: payload = {'key': 'value'};
        if(addMetaData) { payload.application_id  = 'com.selfstudys'; payload.app_version = 1; payload.uuid = getUserUUID(); payload.page = "https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209"; payload.device_type = 2; }
        return new Promise((resolve, reject) => {
            $.ajax({ method: "POST", url: postUrl, dataType: 'json', data: payload })
                .done(function(data) { resolve(data); })
                .fail(function( msg ) { reject("Failed POST Request for: " + postUrl + "; Message: " + msg); });
        });
    }

    function saveDataToLocalForage(key, value) {
        return new Promise(function(resolve, reject) {
            if (typeof key === 'string') {
                localforage.setItem(key, value)
                    .then(function() { resolve(value); })
                    .catch(function(err) { reject('Error saving data to localforage: ' + err); });
            } else { reject('Key must be a string to save in localforage'); }
        });
    }
    function getDataFromLocalForage(key) {
        // console.log('getDataFromLocalForage key is ' + key);
        return new Promise(function(resolve, reject) {
            if (typeof key === 'string') {
                localforage.getItem(key)
                    .then(function(value) { resolve(value); })
                    .catch(function(err) { reject(err); });
            } else { reject('Key must be a string to get from localforage'); }
        });
    }
    function deleteDataFromLocalForage(key) {
        return new Promise(function(resolve, reject) {
            if (typeof key === 'string') {
                localforage.removeItem(key)
                    .then(function() { resolve('Data deleted successfully'); })
                    .catch(function(err) { reject('Error deleting data from localforage: ' + err); });
            } else { reject('Key must be a string to delete in localforage'); }
        });
    }

    function getSegmentCount(url) {
        const urlObj = new URL(url);
        return urlObj.pathname.split('/').filter(Boolean).length;
    }

    $(document).ready(function() {
        $('#closeNotifyDiv').on('click', function() {
            $('#notify').addClass('hideThis');
        });
    });
    $('.hideItsParent').click(function(){
        $(this).parent().addClass('hideThis');
    });

    function checkIfValueIsCorrect(value) {
        if(value !== null && value !== 'null' && value !== '' && value !== 'undefined') { return true; }
        return false;
    }

    function isValidJSONString(str) {
        try {
            JSON.parse(str);
        } catch (e) {
            return false;
        }
        return true;
    }

    function limitNumberLength(field) {
        $('.generateOTPBtn').removeClass('btn-primary').addClass('btn-secondary');
        if(field.value.length > 9) {
            $('.generateOTPBtn').removeClass('btn-secondary').addClass('btn-primary');
        }

        if (field.value.length > 10) {
            field.value = field.value.slice(0, 10);
        }
    }

    $('.slide-link').on('click', function() {
        const currItemIndex = $(this).attr('id').split("-")[1];
        $("#slide-sub-menu-" + currItemIndex).toggle();
        $("#slide-li-" + currItemIndex).toggleClass("slide-li");
        $("#nav-class-" + currItemIndex).toggleClass('rotate');
    });

    $('#headerSearchIcon').click(function(){
        $('#headerMenuLogo').attr("style", "display:none !important");
        $('#headerSearchIcon').hide();
        $('#headerLoginProfile').hide();
        $('#headerGoogleSearchForm').attr("style", "display:block");
        $('#headerGoogleSearchCross').attr("style", "display:block !important");
    });
    $('#headerGoogleSearchCross').click(function(){
        $('#headerMenuLogo').attr("style", "display:flex !important");
        $('#headerSearchIcon').show();
        $('#headerLoginProfile').show();
        $('#headerGoogleSearchForm').attr("style", "display:none");
        $('#headerGoogleSearchCross').attr("style", "display:none !important");
    });

</script>

<div id="emptyPopup" class="modal fade selfstudyModelPopup" role="dialog" tabindex="-1">
    <div class="modal-dialog ncertLoginPopup" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 getStatPopup"><span id="popupTitle"></span>
                    <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/logo.png" alt="Get Started with" id="popupHeaderImage">
                </h4>
                <button type="button" class="close btn-close" data-bs-dismiss="modal" aria-label="Close" id="popupHeaderCloseBtn"></button>
            </div>
            <div class="modal-body" id="popupBody"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary popupActionBtn hideThis" id="emptyPopupBtnClose" data-bs-dismiss="modal">OK</button>
                <button type="button" class="btn btn-success popupActionBtn hideThis showLoginPopup" id="popupAskLoginBtn">Login</button>
                <button type="button" class="btn btn-success popupActionBtn hideThis" id="popupStartTestBtn">Start Test</button>
                <button type="button" class="btn alert-info popupActionBtn hideThis" id="popupResendVerificationEmail">Resend Email</button>
                <button type="button" class="btn alert-success popupActionBtn hideThis" id="popupAlreadyVerifiedEmail">Already Verified</button>
            </div>
        </div>
    </div>
</div>
<script>
    function updateHeaderProfileView() {
        // if (getDataFromLocalStorage('selfstudyUserPhotoUrl')) {
        //   $('#headerUserPic').attr("src",getUserProfileUrl(getDataFromLocalStorage('selfstudyUserPhotoUrl')));
        // }
        $('#headerUserName').html(getDataFromLocalStorage('selfstudyUserDisplayName'));
        $('#headerProfileDiv').removeClass('hideThis');
        $('#headerLoginBtnDiv').addClass('hideThis');
        $('.loginRegisterBtnSection').addClass('hideThis');
    }

    var nextPageUrl = null;

    function hideEmptyForm() {
        $('#emptyPopup').modal('hide');
    }
    function showEmptyForm(title, body, hideHeaderImage, hideHeaderCloseBtn, closeBtnTitle, goToUrl, customPopupId) {
        $('#popupTitle').html(title);
        $('#popupBody').html(body);
        $('.selfstudyModelPopup').modal('hide');
        if (hideHeaderImage == 1) { $('#popupHeaderImage').hide(); }
        if (hideHeaderCloseBtn == 1) { $('#popupHeaderCloseBtn').hide(); }
        if (closeBtnTitle != "") { $('#emptyPopupBtnClose').html(closeBtnTitle); }

        $('.popupActionBtn').addClass("hideThis");

        if (customPopupId == 1) {
            $('#popupAskLoginBtn').removeClass("hideThis");
            if (closeBtnTitle != "") { $('#emptyPopupBtnClose').removeClass("hideThis"); }
        } else if (customPopupId == 2) {
            nextPageUrl = goToUrl;
            $('#popupStartTestBtn').removeClass("hideThis");
            $('#emptyPopupBtnClose').removeClass("hideThis");
        } else if (customPopupId == 3) {
            $('#popupResendVerificationEmail').removeClass("hideThis");
            $('#popupAlreadyVerifiedEmail').removeClass("hideThis");
        } else {
            $('#emptyPopupBtnClose').removeClass("hideThis");
        }
        $('#emptyPopup').modal('show');
    }

    $(document).ready(function() {
        $("#popupStartTestBtn").click(function () { $('#emptyPopup').modal('hide'); window.location.href = nextPageUrl; });
        $("#popupResendVerificationEmail").click(function () { $('#popupBody').html('Please wail...'); sendFirstTimeEmailVerification(); });
        $("#popupAlreadyVerifiedEmail").click(function () { $('#popupBody').html('Please wail...'); checkIfUserVerified(); });
    });

    function sendErrorToServer(errorMessage) {
        var apiUrl = "https://www.selfstudys.com/log-selfstudy-error";
        var apiData = {page_url: "https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209", message: errorMessage, _token: "aXHdEQo93oJQD26T1Uha0HKAcsxXALvZlX5V7rlI"};
        $.ajax({
            type: 'POST',
            url: apiUrl,
            data: apiData,
            success: function(responsedata, status, xhr) {
                //console.log(responsedata);
            },
            error: function(responsedata) {
                //console.log(responsedata);
            },
        });
    }

    function numberEnding (number) {
        return (number > 1) ? 's' : '';
    }

    function millisecondsToStr(duration) {
        seconds = Math.floor((duration / 1000) % 60),
            minutes = Math.floor((duration / (1000 * 60)) % 60),
            hours = Math.floor((duration / (1000 * 60 * 60)) % 24);

        var totleTime = "";
        if (hours > 0) { hours = (hours < 10) ? "0" + hours : hours;                totleTime = totleTime + hours + " hours "; }
        if (minutes > 0) { minutes = (minutes < 10) ? "0" + minutes : minutes;      totleTime = totleTime + minutes + " minutes "; }
        if (seconds > 0) { seconds = (seconds < 10) ? "0" + seconds : seconds;      totleTime = totleTime + seconds + " seconds"; }

        return totleTime;
    }

    function calculateTestScore(rawData, testScore) {
        console.log("rawData :" + JSON.stringify(rawData));
        var correctAns = rawData.correctAns;
        var wrongAns = rawData.wrongAns;
        var negativeMarking = rawData.mockHomeBean.negativeMarking;
        var questMarks = rawData.mockHomeBean.questMarks;
        var testMarkes = rawData.mockHomeBean.testMarkes;

        if (testMarkes == 0) {
            testMarkes = rawData.numberOfQue * questMarks;
        }

        if (testScore == null) {
            testScore = (correctAns * questMarks) - (wrongAns * negativeMarking);
            testScore = testScore.toFixed(2);
        }

        $('.testScore').html(testScore);
        $('.totalScore').html(testMarkes);
    }

    function saveDataToLocalStorage(key, value) {
        window.localStorage.setItem(key, value);
    }

    function saveDataToLocalStorageWithExpiration(key, value, expireSeconds) {
        window.localStorage.setItem(key, value);
        let expires = Date.now() + expireSeconds * 1000;
        window.localStorage.setItem(key + '_expires_at', expires);
    }

    function getDataFromLocalStorage(key) {
        return window.localStorage.getItem(key);
    }

    function removeItemFromLocalStorage(key) {
        return window.localStorage.removeItem(key);
    }

    function deleteExireItemsFromLocalStorage() {
        Object.keys(window.localStorage).forEach(key => {
            let expires = window.localStorage.getItem(key + '_expires_at');
            if(expires && Date.now() > expires) {
                window.localStorage.removeItem(key);
                window.localStorage.removeItem(key + '_expires_at');
            }
        });
    }
    deleteExireItemsFromLocalStorage();

    function getUserProfileUrl(imageName) {
        if (imageName.startsWith("http")) {
            return imageName;
        } else {
            return "https://www.topcoaching.in/paid/users/images/" + imageName;
        }
    }

    function checkUserStatus() {
        if(checkIfValueIsCorrect(getUserUUID())) {
            return 1;
        } else {
            return 3;
        }
    }

    function isUserLoggedIn() {
        if(checkIfValueIsCorrect(getUserUUID())) {
            return true;
        } else {
            return false;
        }
    }

    function getUserUUID() {
        return getDataFromLocalStorage('selfstudyUUID');
    }


</script>
<style>
    #goToTop { display: none; position: fixed; bottom: 40px; right: 30px; z-index: 99; background: transparent; cursor: pointer; opacity: 0.37;}
    #goToTop:hover { opacity: 1.0; }
</style>
<div id="goToTop">
    <img src="https://www.selfstudys.com/viewncert/design-march-2021/images/go-to-top.png" style="width: 50px; height: 50px;">
</div>
<script>
    window.onscroll = function() {scrollFunction()};
    $('#goToTop').click(function() {
        //window.scrollTo(10, 10);
        $("html, body").animate({ scrollTop: 0 }, 100);
        return false;
    });

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            $('#goToTop').show();
        } else {
            $('#goToTop').hide();
        }
    }
</script>


<script>
    const cucamptracker = {
        incrementViews(campid) {
            if(checkIfValueIsCorrect(campid)) {
                let campobjkey = 'ccamp' + campid;
                getDataFromLocalForage(campobjkey).then(function(cucamp) {
                    if (cucamp !== null) {
                        // console.log('cucamptracker incrementViews cucamp is not null', cucamp);
                        let cviews = cucamp.views || 0;
                        cviews++;
                        cucamp.views = cviews;
                    } else {
                        // console.log('cucamptracker incrementViews cucamp is null', cucamp);
                        cucamp = { views: 1, clicks: 0 };
                    }

                    saveDataToLocalForage(campobjkey, cucamp).then(function(result) {
                        // console.log('cucamptracker incrementViews result', result);
                    }).catch(function(error) {
                        console.log('error cucamptracker incrementViews', error);
                    });
                }).catch(function(error) {
                    console.log('error cucamptracker incrementViews', error);
                });
            } else {
                console.log('cucamptracker incrementViews campid is not correct: ' + campid);
            }
        },
        incrementClick(campid) {
            if(checkIfValueIsCorrect(campid)) {
                let campobjkey = 'ccamp' + campid;
                getDataFromLocalForage(campobjkey).then(function(cucamp) {
                    if (cucamp !== null) {
                        // console.log('cucamptracker incrementViews cucamp is not null', cucamp);
                        let cclicks = cucamp.clicks || 0;
                        cclicks++;
                        cucamp.clicks = cclicks;
                    } else {
                        // console.log('cucamptracker incrementViews cucamp is null', cucamp);
                        cucamp = { views: 1, clicks: 1 };
                    }

                    saveDataToLocalForage(campobjkey, cucamp).then(function(result) {
                        // console.log('cucamptracker incrementViews result', result);
                    }).catch(function(error) {
                        console.log('error cucamptracker incrementViews', error);
                    });
                }).catch(function(error) {
                    console.log('error cucamptracker incrementViews', error);
                });
            } else {
                console.log('cucamptracker incrementViews campid is not correct: ' + campid);
            }
        }
    }

    function intersectionCallback(entries, observer) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const elemId = $(entry.target).data('campid');
                cucamptracker.incrementViews(elemId);
                intersectionObserver.unobserve(entry.target);
            }
        });
    }

    let intersectionOptions = { root: null,  rootMargin: '0px',  threshold: 0.7 };
    let intersectionObserver = new IntersectionObserver(intersectionCallback, intersectionOptions);
    $(document).on("intCampAdded", function(event) {
        intersectionObserver.observe(event.target);
    });

    function getCurrentPageClassId() {
        var classId = getDataFromLocalStorage('selfstudyUserClassId');
        if(!checkIfValueIsCorrect(classId)) { classId = 0; }
        return classId;
    }

    function getCurrentPageClassCategoryId() { //1 means 12th, 2 means other
        const classId = getCurrentPageClassId();
        let categoryId = 2;
        if(classId == 0 || classId == 14 || classId == 34 || classId == 35 || classId == 36 || classId == 37 || classId == 2 || classId == 15 || classId == 18 || classId == 21 || classId == 24) { categoryId = 1; }
        return categoryId;
    }

    function getIntCampsFromServer() {
        return new Promise(function(resolve, reject) {
            var currPage      = "https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209";
            var pageTitle     = $(document).prop('title');
            var stateId       = getDataFromLocalStorage('selfstudyUserStateId');
            var uuid          = getUserUUID();

            if(!checkIfValueIsCorrect(stateId)) { stateId = 0; }
            const classId = getCurrentPageClassId();
            const categoryId = getCurrentPageClassCategoryId();

            if(checkIfValueIsCorrect(pageTitle) && getSegmentCount(currPage) > 0) {
                const payload = {'category_id': categoryId, 'class_id': classId, 'state_id': stateId, 'uuid': uuid, 'application_id': 'com.selfstudys', 'app_version': 1};

                $.ajax({
                    method: 'GET',
                    url: "https://appanalytics.co.in/gocampcallback/api/v1/get-website-camp",
                    dataType: 'json',
                    data: payload
                })
                    .done(function(serverUserData) {
                        // console.log('Received Intrnl Camps Data From Server',serverUserData);
                        resolve(serverUserData);
                    })
                    .fail(function(jqXHR, textStatus, error) {
                        console.log('Error: ', error);
                        reject(new Error("AJAX request failed"));
                    });
            } else {
                reject('no need to get intCamp for this page');
            }
        });
    }

    const findNextIntrnlCamp = async (intrnlCampsArray, canReCall) => {
        let blankObj = { views: 0, clicks: 0 };

        const categoryId = getCurrentPageClassCategoryId();
        if(categoryId == 1) { //12thCamps
            var classSpecificCampArray = intrnlCampsArray["1"];
        } else if(categoryId == 2) { //OtherCamp
            var classSpecificCampArray = intrnlCampsArray["2"];
        }

        for (let ccamp of classSpecificCampArray) {
            const storageKey = `ccamp${ccamp.id}`;
            let storageData;

            try { storageData = await getDataFromLocalForage(storageKey); } catch(error) { continue; }

            if (checkIfValueIsCorrect(storageData) && checkIfValueIsCorrect(storageData.views) && checkIfValueIsCorrect(storageData.clicks)) {
                if (storageData.views < ccamp.view_counts && storageData.clicks < ccamp.click_counts && checkIfValueIsCorrect(ccamp.top_title) && checkIfValueIsCorrect(ccamp.top_url)) {
                    return { topcamp: ccamp, allcamps: classSpecificCampArray };
                }
            } else {
                saveDataToLocalForage(storageKey, blankObj);
                continue;
            }
        }

        for (let ccamp of classSpecificCampArray) {
            const storageKey = `ccamp${ccamp.id}`;
            await saveDataToLocalForage(storageKey, blankObj);
        }

        if(canReCall) {
            return findNextIntrnlCamp(intrnlCampsArray, false);
        }
    };

    var displayList = { imgarray: [], linkarray: [] };
    var maxImgCampCount = 2;
    var maxLinkCampCount = 4;
    var imgCampCount = 0;
    var linkCampCount = 0;
    var addedImgCamps = new Set();
    var addedLinkCamps = new Set();
    var promises = [];

    function canAddCamp(camp, campmetadata, isImage, ignoreCounts) {
        return (isImage ? checkIfValueIsCorrect(camp.sidebar_image) && checkIfValueIsCorrect(camp.sidebar_image_url) : checkIfValueIsCorrect(camp.sidebar_link_title) && checkIfValueIsCorrect(camp.sidebar_link_url)) && (ignoreCounts || (campmetadata.views < camp.view_counts && campmetadata.clicks < camp.click_counts));
    }

    function populateDisplayList(allcamps, ignoreCounts = false, callCount = 0) {
        allcamps.forEach(camp => {
            const storageKey = `ccamp${camp.id}`;
            var promise = getDataFromLocalForage(storageKey)
                .then(function(campmetadata) {
                    if (imgCampCount < maxImgCampCount && canAddCamp(camp, campmetadata, true, ignoreCounts) && !addedImgCamps.has(camp.id)) {
                        displayList.imgarray.push(camp);
                        imgCampCount++;
                        addedImgCamps.add(camp.id);
                    }

                    if (linkCampCount < maxLinkCampCount && canAddCamp(camp, campmetadata, false, ignoreCounts) && !addedLinkCamps.has(camp.id)) {
                        displayList.linkarray.push(camp);
                        linkCampCount++;
                        addedLinkCamps.add(camp.id);
                    }
                });

            promises.push(promise);
        });

        return Promise.all(promises).then(() => {
            if ((imgCampCount < maxImgCampCount || linkCampCount < maxLinkCampCount) && callCount < 1) {
                return populateDisplayList(allcamps, true, callCount + 1);
            }
            return displayList;
        });
    }

    function pickAndDisplayIntrnlCamp(intrnlCampsArray) {
        // console.log('pickAndDisplayIntrnlCamp', intrnlCampsArray);
        findNextIntrnlCamp(intrnlCampsArray.data, true)
            .then(function(result) {
                // console.log('result.allcamps', result.allcamps);
                if(checkIfValueIsCorrect(result) && checkIfValueIsCorrect(result.topcamp)) {
                    $("#websiteTopMessageDiv")
                        .css("background", result.topcamp.topbgcolor)
                        .attr('class', function(i, c) { return c.replace('bg-yellow', ''); });
                    $("#websiteTopMessageLink")
                        .attr("href", result.topcamp.top_url)
                        .attr("class", "int-camp-link")
                        .attr("data-source", "websitetop")
                        .attr("data-campid", result.topcamp.id)
                        .text(result.topcamp.top_title)
                        .trigger("intCampAdded");
                }

                let imgCampCount = 0; let linkCampCount = 0;
                $('#sidebarImgCamps').html('');$('#sidebarLinkCamps').html('');

                populateDisplayList(result.allcamps).then(displayList => {
                    // console.log("displayList", displayList);

                    $.each(displayList.imgarray, function(index, camp) {
                        if(checkIfValueIsCorrect(camp.sidebar_image) && checkIfValueIsCorrect(camp.sidebar_image_url)) {
                            $('#sidebarImgCamps')
                                .append(`<a href="${camp.sidebar_image_url}" target="_blank" class="int-camp-link" data-campid="${camp.id}" data-source="sidebarimage"><img src="${camp.sidebar_image}" alt="selfstudys" loading="lazy"></a>`);
                        }
                    });

                    $.each(displayList.linkarray, function(index, camp) {
                        if(checkIfValueIsCorrect(camp.sidebar_link_title) && checkIfValueIsCorrect(camp.sidebar_link_url)) {
                            $('#sidebarLinkCamps')
                                .append(`<li><a href="${camp.sidebar_link_url}" target="_blank" class="int-camp-link" data-campid="${camp.id}" data-source="sidebarlink">${camp.sidebar_link_title}</a></li>`);
                        }
                    });
                });
            })
            .catch(function(error) {
                console.log('pickAndDisplayIntrnlCamp error:', error);
            });
    }

    function getSetIntrnlCampOnThisPage(isRefreshData) {
        getDataFromLocalForage('intrnldisplaycamp')
            .then(function(localdata) {
                if (localdata !== null && !isOldEnough(localdata, 86400) && !isRefreshData) {
                    // console.log('Found Internl Camp Data in LocalForge', localdata);
                    pickAndDisplayIntrnlCamp(localdata);
                } else {
                    getIntCampsFromServer()
                        .then(function(serverData) {
                            const dataToStore = { timestamp: new Date().getTime(), data: serverData };
                            // console.log('Going to store Intrnl Capms Server data to LocalForage', dataToStore);

                            saveDataToLocalForage('intrnldisplaycamp', dataToStore)
                                .then(function(localSavedData) {
                                    // console.log('this data is saved in LocalForage:', localSavedData);
                                    pickAndDisplayIntrnlCamp(dataToStore);
                                })
                                .catch(function(error) {
                                    console.log('getSetIntrnlCampOnThisPage error:', error);
                                });

                            // localforage.keys().then(function(keys) {
                            //     // Regular expression to match 'ccamp' followed by one or more digits, and ensure it ends with a digit
                            //     const pattern = /^ccamp\d+$/;

                            //     const removalPromises = keys.filter(key => key.match(pattern)).map(key => {
                            //         return localforage.removeItem(key).then(() => {
                            //             console.log(`Removed: ${key}`);
                            //         }).catch(err => {
                            //             console.error(`Error removing ${key}: `, err);
                            //         });
                            //     });

                            //     return Promise.all(removalPromises);
                            // }).then(() => {



                            // }).catch(err => {
                            //     console.error("An error occurred during the removal process: ", err);
                            // });
                        })
                        .catch(function(error) {
                            // console.log('Error:', error);
                        });
                }
            })
            .catch(function(error) {
                console.log('checkIntrnlCampDisplay', error);
            });
    }

    $(document).on('click', '.int-camp-link', function(e) {
        const campId = $(this).data('campid');
        const source = $(this).data('source');
        const aHref = $(this).attr('href');

        if (checkIfValueIsCorrect(campId) && campId > 0 && checkIfValueIsCorrect(source) && checkIfValueIsCorrect(aHref)) {
            if (checkIfValueIsCorrect(getUserUUID())) {
                let payload = { 'camp_id': campId, 'source': source, 'link': aHref };
                performPOSTRequest("https://topcoaching.in/api/log-user-clicks-v2", payload, true)
                    .then(function(data) {  })
                    .catch(function(error) { console.log('Error:', error); });
            }

            cucamptracker.incrementClick(campId);
        }
    });

</script>

<script>

    $(document).ready(function(){
        if(window.matchMedia("(max-width: 767px)").matches) {
            //console.log('Mobile Viewport');
        } else {
            //console.log('Desktop Viewport');
            $(window).scroll(function() {
                if ($(this).scrollTop() > 300) {
                    $('.applicant-area').addClass('area-active');
                } else {
                    $('.applicant-area').removeClass('area-active');
                }
            });
        }


        $(window).scroll(function(){
            if ($(this).scrollTop() > 300) {
                $('.time-left').addClass('time-active');
                $('.time-left').addClass('shadow-custom');
            } else {
                $('.time-left').removeClass('time-active');
                $('.time-left').removeClass('shadow-custom');
            }
        });
    });

    // for question navigator mobile adjustment
    // const tabId = document.getElementById("check");
    // const qWrap = document.getElementById("quesNavWrap");
    // tabId.addEventListener("click", (e) => {
    //     if (qWrap.classList.contains("activeNav")) {
    //         qWrap.classList.remove("activeNav");
    //     } else { qWrap.classList.add("activeNav"); }
    // });

    // $(document).ready(function(){
    //     if(window.matchMedia("(max-width: 767px)").matches) {
    //         //console.log('Mobile Viewport');
    //     } else {
    //         //console.log('Desktop Viewport');
    //         $('#check').prop('checked', true);
    //         $('#quesNavWrap').addClass('activeNav');
    //     }
    // });

    var isTestSubmited = false;
    var currSeconds = 0;
    var remainingSeconds = 1200;
    var startTime = Date.now();
    var totalSeconds = 1200;
    var refreshIntervalId = setInterval(setTime, 1000);

    function setTime() {
        --remainingSeconds;
        ++currSeconds;
        $('#timeLeftSpanId').text(pad(parseInt(remainingSeconds / 60)) + ":" + pad(remainingSeconds % 60) + " MIN");
        if(remainingSeconds == 0) { clearInterval(refreshIntervalId); showTimeExpirePopup(); }
    }
    function pad(val) {
        var valString = val + "";
        if (valString.length < 2) { return "0" + valString; } else { return valString; }
    }

    $("#quiz input:radio").change(function () {
        const currName = $(this).attr('name');
        const currId = '#qNavigator-' + currName.slice(9);
        $(currId).parent().removeClass('not-done');

        let userQData = $("#quiz").serializeArray();
        var ansCount = 0;
        var totalQCount = 0;
        for(var index in userQData) {
            let jsonItem = userQData[index];
            var qId = jsonItem.name.slice(7);
            console.log(JSON.stringify(jsonItem));
            if (jsonItem.name.startsWith('question-')) {
                ansCount++;
            } else if(jsonItem.name.startsWith('answer-')) {
                totalQCount++;
            }
        }

        $('#qAnsweredCount').html(ansCount);
        $('#qUnAnsweredCount').html((totalQCount - ansCount));
    });

    $('.ansMarkItem').click(function () {
        const currId = $(this).attr('id').slice(11);
        $('html, body').animate({ scrollTop: $("#question-"+currId).offset().top }, 100);

        if(needToCloseApplicantArea) {
            $('.applicant-area').hide(100);
        }
    });

    function showTimeExpirePopup() {
        $('#popupTitle').html("Physics Test 209");
        $('#popupBody').html("This Test Time has expired. Test Will be submitted now.");
        $('.selfstudyModelPopup').modal('hide');
        $('#popupHeaderImage').hide();
        $('#popupHeaderCloseBtn').hide();
        $('.popupActionBtn').addClass("hideThis");
        $('#emptyPopupBtnClose').removeClass("hideThis");

        $("#emptyPopupBtnClose").click(function () { $("a.submitTest").trigger("click"); });

        $('#emptyPopup').modal('show');
    }

    $("a.submitTest").on("click", function(e) {
        $('#loader-wrapper').removeClass('hideThis');
        let userQData = $("#quiz").serializeArray();
        const questionData = [];
        for(var index in userQData) {
            let jsonItem = userQData[index];
            //console.log('jsonItem => ' + JSON.stringify(jsonItem));
            if (jsonItem.name.startsWith('answer-')) {
                var qId = jsonItem.name.slice(7);
                var userSelectd = $("input[name=question-" + qId +"]:checked").val();
                if (userSelectd === undefined) { userSelectd = ""; }
                const qItem = {'question_id':qId,'question_ans':jsonItem.value,'user_ans':userSelectd};
                questionData.push(qItem);
            }
        }

        //if (totalSeconds >= currSeconds) { var tTime = currSeconds*1000; } else { var tTime = totalSeconds*1000; }
        var tTime = currSeconds*1000;

        var catId = 4743;         var testId = 47667;
        var endTime = Date.now();

        const testData = {'category_id': catId, 'test_id': testId, 'application_id': 'com.selfstudys', 'app_version': 1, 'all': 10, 'type': "category", 'title': "Physics Test 209", 'category_title': "Physics", 'time': tTime, 'start_time': startTime, 'end_time': endTime,"user_uuid": getOfflineUserUUID(),"uuid": getUserUUID(), "quest_marks": 4, "negetive_marking": 1, "test_markes": 40, 'normal_test_type': 2 };

        const reqPayload = JSON.stringify({'test_data': testData, 'question_data': questionData});
        var localStorageTestKey = "web_test_json";
        var formData = new FormData();
        formData.append("web_test_json", reqPayload);

        $.ajax({
            type: "POST",
            url: "https://topcoaching.in:8081/api/v9/gk/save-game-result-web",
            enctype: 'multipart/form-data',
            processData: false, // tell jQuery not to process the data
            contentType: false,
            data: formData
        })
            .done(function(responsedata, status, xhr) {
                var json = JSON.parse(responsedata);
                if (json.status == "success") {
                    isTestSubmited = true;
                    if (json.data.status == "success") {
                        window.location.href = "set3chemistryS.html";
                    } else {
                        if (json.data.error_code == 1) { //re-attempted
                            saveDataToLocalStorage(localStorageTestKey, reqPayload);
                            window.location.href = "set3chemistryS.html";
                        } else if (json.data.error_code == 2) { //not-loggedin or invalid user_uuid
                            saveDataToLocalStorage(localStorageTestKey, reqPayload);
                            window.location.href = "set3chemistryS.html";
                        } else {
                            alert(json.data.message);

                            sendErrorToServer('Error in SubmitTest1: ' + json.data.error_code + '; message: ' + json.data.message + "; OldUUID: " + getOfflineUserUUID() + " ; NewUUID: " + getUserUUID());
                        }
                    }
                }
            })
            .fail(function(xhr, status, error) {
                $('#loader-wrapper').addClass('hideThis');

                if(checkIfValueIsCorrect(getUserUUID())) {
                    let errorMessage = xhr.status + ': ' + xhr.responseText;
                    if(xhr.responseJSON && xhr.responseJSON.message) {
                        errorMessage = xhr.responseJSON.message;
                    }

                    sendErrorToServer('Error in SubmitTest2: ' + errorMessage + "; OldUUID: " + getOfflineUserUUID() + " ; NewUUID: " + getUserUUID() + " ; " + reqPayload);
                }
            });
    });

    $(window).bind("beforeunload", function(event) {
        if (isTestSubmited) {
            $(window).unbind('beforeunload');
        } else {
            return "Test will be Restart if you refresh this page. Are you sure ?";
        }
    });
</script>


<script>
    function setUsernameAndUserProfilePic() {
        if (getDataFromLocalStorage('selfstudyUserDisplayName') != null) {
            $('#currUserName').html(getDataFromLocalStorage('selfstudyUserDisplayName'));
        }
        if (getDataFromLocalStorage('selfstudyUserPhotoUrl') != null) {
            $('#currUserProfilePic').prop('src', getUserProfileUrl(getDataFromLocalStorage('selfstudyUserPhotoUrl')));
        }
    }
    setUsernameAndUserProfilePic();
    $('.showHiddenArea').click(function() {
        $(this).prev().css('height','auto');
        $(this).hide();
    });
</script>


<script>
    function userIsLoggedIn() {
        $('#headerProfileDiv').removeClass('hideThis');
        $('#headerLoginBtnDiv').addClass('hideThis');
        $('.loginRegisterBtnSection').addClass('hideThis');
        updateHeaderProfileView();

        // console.log("currentPageId: 2" );

    }


    function getOfflineUserUUID() {
        return getUserUUID();
    }

    $(window).on('load', function() {
        if(checkIfValueIsCorrect(getUserUUID())) {
            userIsLoggedIn();
        } else {
            userIsNotLoggedIn();
        }
    });
</script>
<script>
    document.addEventListener("contextmenu", function(e) { e.preventDefault(); }, false);
</script>

<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async defer crossorigin="anonymous"></script> <!-- Used also for ads Units -->
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-6913072320040860",
        enable_page_level_ads: true
    });
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script src="https://www.googletagmanager.com/gtag/js?id=UA-127677230-2" async defer crossorigin="anonymous"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-127677230-2');
</script>

<div id="pushNotificationContainer" class="push-notification-container hideThis">
    <style>.NotificationWrapper, .default-notification-bg{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,.4);z-index:9999}.default-notification-bg.hide{display:none}.NotificationBox{background:#fff;padding:12px;border-radius:4px;box-shadow:0 2px 8px 0 rgba(0,0,0,.2),0 2px 0 1px rgba(0,0,0,.04);width:310px;position:absolute;left:100px;top:0}.NotificationContent{position:relative}.NotificationContent .nrow{display:flex;align-items:center}.NotificationContent .nrow.end{justify-content:flex-end}.NotificationContent .end{padding-top:10px}.NotificationBox .appLogoIcon{display:inline-block;width:50px;height:50px;min-width:44px;background:#eee;margin-right:10px}.NotificationBox .ntfcsn-txt{font-weight:600;font-size:1rem}.NotificationBox .nPopupCancelBtn{margin:0 10px 0 0;color:#666;font-weight:600;cursor:pointer;font-size:.875rem}.NotificationBox .ntfcsn-crossX{font-size:20px;line-height:10px;color:#000;text-decoration:none;cursor:pointer;opacity:.5;position:absolute;right:-16px;top:-16px;padding:10px}.NotificationHelperBox{position:absolute;top:125px;color:#fff;font-size:26px;font-weight:600;width:300px;text-align:center;line-height:32px;left:225px;text-shadow:1px 1px 6px rgba(0,0,0,0.9)}.helperIcon{height:45px}@media  screen and (min-width:320px) and (max-width:767px){.NotificationBox{left:50%;top:50%;transform:translate(-50%,-50%)}.NotificationHelperBox{display:none}}.default-notification-bg .NotificationHelperBox{top:50%;left:50%;transform:translate(-100%,-100%)}button#nPopupAllowBtn{background-color: #F37921!important;border-color: #F37921!important;color: #fff!important;font-weight: 600;min-width: 90px;padding: 3px 10px;}</style>
    <div class="NotificationWrapper" id="notificationWrapper">
        <div class="NotificationBox">
            <div class="NotificationContent">
                <div class="nrow start" id="logoBox">
                    <img class="ntfcsnIcon appLogoIcon" src="/viewncert/design-april-2022/images/logo_50_50.png">
                    <strong class="ntfcsn-txt">Get latest Exam Updates <br>& Study Material Alerts!</strong>
                </div>
                <div class="nrow end">
                    <span class="nPopupCancelBtn" id="nPopupCancelBtn">No, Thanks</span>
                    <button class="button button--orange" id="nPopupAllowBtn">Allow</button>
                </div>
            </div>
        </div>
        <div class="NotificationHelperBox" id="NotificationHelperBox">
            <img class="ntfcsn-icon helperIcon" src="/viewncert/design-april-2022/images/arrow-pointer.svg">
            <div class="helper-txt">Click on Allow to receive notifications</div>
        </div>
    </div>
</div>
<section class="notify hideThis" id="notify">
    <div class="notify-step position-relative d-flex align-items-center justify-content-center">
        <div class="notify-box">
            <div class="n-head d-flex justify-content-sm-between align-items-center mb-3">
                <div class="n-head-title">Allow Notification</div>
                <div class="n-head-close"><a href="javascript:void(0);" id="closeNotifyDiv"><img src="/viewncert/design-april-2022/images/circle-close.svg"></a></div>
            </div>
            <div class="notify-img">
                <img src="/viewncert/design-april-2022/images/notificantion-enable-desktop.gif" alt="" class="desktop-gif">
                <img src="/viewncert/design-april-2022/images/notificantion-enable-mobile.gif" alt="" class="mobile-gif">
            </div>
            <div class="n-steps mt-2">To enable notifications follow this 2 steps:</div>
            <ul class="notify-list mt-2">
                <li class="d-flex align-items-center mb-1"> First Click on Secure Icon <a href="#" class="ms-2"><img src="/viewncert/design-april-2022/images/secure-icon.svg" alt=""></a></li>
                <li class="d-flex align-items-center"> Second click on the toggle icon
                    <div class="form-check form-switch ms-2">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                    </div>
                </li>
            </ul>
        </div>

        <div class="container position-relative">
            <div class="notify-details">
                <div class="allow-no">Allow Notification</div>
                <div class="update">Get latest Exam Updates & FREE Study Material Alerts!</div>
            </div>
        </div>
    </div>
</section>


<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-messaging.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-auth.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
    .notificationPopUp {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 15%;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
    }
    #notification-bell {
        float: left;
        height: 40px;
        margin-left: 5px;
    }
    #notificationPopUpCloseBtn {
        float: right;
    }
    .notificationPopUpContainer {
        margin-top: 20px;
    }
    .notificationPopUpMiddle {
        text-align: center;
        width: 100%;
        padding: 10px;
        margin-top: 30px;
    }
    .nitificationPopUpItem {
        margin-bottom: 10px;
    }
    #notificationPopUpImgTag {
        height: 150px;
    }
    .notificationPopUpBtn {
        color: white;
        padding: 14px 20px;
        cursor: pointer;
        opacity: 0.9;
        display: inline-block;
        text-align: center;
        border-radius: 20px;
    }

    .notificationPopUpBtn:hover {
        opacity:1;
    }

    #notificationPopUpCancelBtn {
        background-color: #ccc;
        color: black;
        margin-right: 20px;
    }

    /* Add a color to the delete button */
    #notificationPopUpUrlBtn {
        background-color: #6531e2;
    }
    .notificationPopUpContainer {
        background-color: #fefefe;
        margin: 15% auto 15% auto;
        border: 1px solid #888;
        width: 80%;
        border-radius: 20px;
    }
    .notificationPopUpClose {
        font-size: 30px;
        font-weight: bold;
        margin-right: 15px;
    }
    .notificationPopUpClose:hover,
    .notificationPopUpClose:focus {
        color: #f44336;
        cursor: pointer;
    }
    .notificationPopUpClearfix {
        clear: both;
        padding: 15px;
        text-align: center;
    }
    .notificationPopUpClearfix::after {
        content: "";
        clear: both;
        display: table;
    }

    /* Change styles for cancel button and delete button on extra small screens */
    @media  screen and (max-width: 360px) {
        .notificationPopUpBtn {
            width: 70%;
        }
        #notificationPopUpCancelBtn {
            margin-bottom: 20px;
        }
    }
</style>


<script>
    //V4
    var firebaseConfig = {
        apiKey: "AIzaSyC5r5d41xPsZnK6hWsBWKxe6UbXJjawRQ4",
        authDomain: "selfstudys.firebaseapp.com",
        projectId: "selfstudys",
        storageBucket: "selfstudys.appspot.com",
        messagingSenderId: "1090334648545",
        appId: "1:1090334648545:web:1b03478ad58ff9582b2fa0",
        measurementId: "G-99QL8X86LF"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // self.addEventListener('notificationclick', function(event) {
    //     var ac = event.notification.click_action;
    //     console.log("ac => " + ac);
    // });

    let messaging = null;
    if (firebase.messaging.isSupported()) {
        messaging = firebase.messaging();
    }

    // var isLoginInProgress = false;
    // var isSendVerificationMail = false;
    var firstLastName = null;
    var currentFirebaseUser = null;

    function getCurrentFirebaseUser() {
        return currentFirebaseUser;
    }

    function getCurrentFirebaseUserUUID() {
        if (currentFirebaseUser != null) {
            return currentFirebaseUser.uid;
        } else {
            return "";
        }
    }

    if (messaging != null) {
        messaging.usePublicVapidKey("BHWhIv-Ls94CPG96kGw_-HJe1PWl7aZ85v1SAYh1oFiu9BG8p0CGBCLJ3_GR2zL06LeNTAs5PL0ItiBWLNCTLWU");
    }


    function requestPermission(source) {
        //console.log('Requesting permission...');
        Notification.requestPermission().then((permission) => {
            if (permission === 'granted') {
                //console.log('Notification permission granted.');
                $('.askForWebNotificationDiv').attr("style", "display: none !important");
                registerToken();
            } else {
                console.log('Unable to get permission to notify.');
                if(source == 2) {
                    // alert('Please Allow Notification Permission by clicking the lock icon next to the URL.');
                    $('#notify').removeClass('hideThis');
                }
            }
        });
    }

    function registerToken() {
        if (messaging != null) {
            messaging.getToken()
                .then(function(currentToken) {
                    if (currentToken) {
                        sendTokenToServer(currentToken);
                    } else {
                        //console.log('No registration token available. Request permission to generate one.');
                    }
                }).catch(function(err) {
                //console.log('An error occurred while retrieving token. ', err);
            });
        }
    }

    // messaging.onTokenRefresh(() => {
    //     messaging.getToken().then((refreshedToken) => {
    //         console.log('Token refreshed.');
    //         setTokenSentToServer(false);
    //         sendTokenToServer(refreshedToken);
    //     }).catch((err) => {
    //         console.log('Unable to retrieve refreshed token ', err);
    //     });
    // });

    if (messaging != null) {
        messaging.onMessage((payload) => {
            //console.log("messaging received...");
            navigator.serviceWorker.getRegistration('/firebase-cloud-messaging-push-scope').then(registration => {

                createDialog(payload.data.title,payload.data.body,payload.data.click_action, payload.data.noti_id, payload.data.host, payload.data.reporting_level,payload.data.image);
            });
        });
    }

    function sendTokenToServer(currentToken) {
        if (doWeNeedToSendTokenToServer(currentToken)) {
            var userUUID = getUserUUID();
            //console.log('Sending token to server...' + userUUID);
            $.ajax({
                method: "POST",
                url: "https://topcoaching.in/api/send-selfstudy-fcm-token-to-server",
                data: { token: currentToken, version_id:1, user_uuid: userUUID, _token: "aXHdEQo93oJQD26T1Uha0HKAcsxXALvZlX5V7rlI" },
                dataType: 'json'
            })
                .done(function(data) {
                    //console.log("Data " + JSON.stringify(data));
                    if (data.status == 'success') {
                        saveTokenToLocalStorage(currentToken);
                        if (userUUID != "") {
                            saveDataToLocalStorage('isFCMTokenMAPToUserUUID', 1);
                        }
                    }
                })
                .fail(function(  jqXHR, textStatus, errorThrown ) {
                    //console.log("Error Message =>" + textStatus);
                });
        } else {
            //console.log('Token already sent to server so won\'t send it again unless it changes');
        }
    }

    function logUserResponse(notiId,isClick,host,reportingLevel) {
        if (host != "" && reportingLevel > 0) {
            $.ajax({
                method: "GET",
                url: host + "/log-user-fcm-response",
                data: { noti_id: notiId, is_click: isClick, version: '3'},
                dataType: 'json'
            })
                .done(function(data) {
                    //console.log("Data =>" + data);
                })
                .fail(function( msg ) {
                    //console.log("Error Message =>" + msg);
                });
        }
    }

    function doWeNeedToSendTokenToServer(token) {
        var storedToken = window.localStorage.getItem('selfstudysTokenV4');
        if (token != storedToken) {
            return true;
        }
        if (getDataFromLocalStorage('isFCMTokenMAPToUserUUID') != 1) {
            return true;
        }
        //console.log("isFCMTokenMAPToUserUUID : " + getDataFromLocalStorage('isFCMTokenMAPToUserUUID') + "; " + token);
        return false;
    }

    function saveTokenToLocalStorage(token) {
        saveDataToLocalStorage('selfstudysTokenV4', token);
        saveDataToLocalStorage('selfstudysTokenSaveTime', getCurrentTime());
    }

    function getCurrentTime() {
        var d = new Date();
        var miliSeconds = d.getTime();
        var currentSeconds = parseInt(miliSeconds / 1000);
        //console.log('currentSeconds: ' + currentSeconds);
        return currentSeconds;
    }

    function isNeedToCheckFirebaseToken() {
        var selfstudysTokenSaveTime = window.localStorage.getItem('selfstudysTokenSaveTime');
        if (selfstudysTokenSaveTime) {
            selfstudysTokenSaveTime = parseInt(selfstudysTokenSaveTime);
            var exTime = selfstudysTokenSaveTime + 60 * 30; //half hour
            if (exTime < getCurrentTime()) {
                return true;
            } else {
                return false;
            }
        } else {
            return true;
        }
    }

    function createDialog(title, body, link, notiId,host,reportingLevel,image) {
        $('#notificationPopUpTitle').append("<b>" + title + "</b>");
        $('#notificationPopUpBody').append(body);
        $('#notificationPopUpImage').append("<a href='" + link + "' target='_blank'><img src='" + image + "' id='notificationPopUpImgTag'></a>");
        $('#notificationPopUp').show();

        $('#notificationPopUpUrlBtn').click(function() {
            window.open(link, '_blank');
            logUserResponse(notiId,3,host,reportingLevel);
            $('#notificationPopUp').hide();
        });
        $('#notificationPopUpCloseBtn').click(function() {
            $('#notificationPopUp').hide();
            logUserResponse(notiId,4,host,reportingLevel);
        });
        $('#notificationPopUpImgTag').click(function() {
            $('#notificationPopUp').hide();
        });
    }

    // window.addEventListener('load', () => {
    //     if ('serviceWorker' in navigator) {
    //         navigator.serviceWorker.getRegistration('/firebase-cloud-messaging-push-scope')
    //         .then(registration => {
    //             registration.update();
    //         })
    //         .catch(err => console.log('Service Worker Error', err));
    //     }
    // });

    // var token = "aXHdEQo93oJQD26T1Uha0HKAcsxXALvZlX5V7rlI";

    function logoutUser(redirectStatus) {
        if (firebase.auth().currentUser) {
            firebase.auth().signOut();
        }

        removeItemFromLocalStorage('selfstudyFirebaseIsVerified');
        removeItemFromLocalStorage('selfstudyUUID');
        removeItemFromLocalStorage('selfstudyFirebaseToken');

        removeItemFromLocalStorage('selfstudyUserDisplayName');
        removeItemFromLocalStorage('selfstudyUserEmailId');
        removeItemFromLocalStorage('selfstudyUserPhotoUrl');
        removeItemFromLocalStorage('isFirebaseGoogleLoginInProgress');
        removeItemFromLocalStorage('selfstudyUserPhone');
        removeItemFromLocalStorage('selfstudyUserPhoneVerified');
        removeItemFromLocalStorage('selfstudyUserClassId');
        removeItemFromLocalStorage('selfstudyUserStreamId');
        removeItemFromLocalStorage('selfstudyUserBoardId');
        removeItemFromLocalStorage('selfstudyUserStateId');
        removeItemFromLocalStorage('selfstudyUserCityId');
        removeItemFromLocalStorage('selfstudyUserGender');
        removeItemFromLocalStorage('selfstudyUserDOB');

        removeItemFromLocalStorage('selfstudyUserClassName');
        removeItemFromLocalStorage('selfstudyUserStreamName');
        removeItemFromLocalStorage('selfstudyUserBoardName');
        removeItemFromLocalStorage('selfstudyUserStateName');
        removeItemFromLocalStorage('selfstudyUserCityName');

        // showEmptyForm("Alert", "You have Logout Successfully.", 0, 0, "OK", "", 0);
        $('#headerProfileDiv').addClass('hideThis');
        $('#headerLoginBtnDiv').removeClass('hideThis');
        $('.loginRegisterBtnSection').removeClass('hideThis');

        if(redirectStatus == 1) {
            window.location.href = "https://www.selfstudys.com";
        } else if(redirectStatus == 2) {
            window.location.href = "https://www.selfstudys.com/mcq/jee/online/mock-test/physics/physics-test-209";
        }
    }

    function loginRegisterToServer(uid, email, displayName, providerId, photoURL, applicationId) {
        if(checkIfValueIsCorrect(getDataFromLocalStorage('loginsource'))) {
            loginSource = getDataFromLocalStorage('loginsource');
        }

        console.log("loginRegisterToServer User FirebaseToken: " + uid + " , uuid: " + getUserUUID() + " , displayName: " + displayName + " , providerId: " + providerId + " , photoURL: " + photoURL + " , email: " + email + " , applicationId: " + applicationId + ' , IsUserLoggedIn: ' + isUserLoggedIn() + " ; ClassId: " + getCurrentPageClassId() + " ; loginSource: " + loginSource);

        if (isUserLoggedIn()) {
            $('#emptyPopup').modal('hide');
        } else {
            getDataFromLocalForage('isLoginInProgress').then(function(value) {
                if(value === null || value == 'no') {
                    saveDataToLocalForage('isLoginInProgress', 'yes').then(function(result) {
                        $.ajax({
                            method: "POST",
                            url: "https://topcoaching.in/api/login-register-website",
                            data: { firebase_id: uid, email: email, name:displayName, provider_id: providerId, device_type: 2, photo_url: photoURL, application_id: applicationId, loginsource: loginSource, class_id: getCurrentPageClassId() },
                            dataType: 'json'
                        })
                            .done(function(data) {
                                deleteDataFromLocalForage('isLoginInProgress');
                                // isLoginInProgress = false;
                                // console.log("data=>" + JSON.stringify(data));

                                if (data.data.status > 0 && data.data.user != null) {

                                    hideEmptyForm();

                                    saveDataToLocalStorage('selfstudyUUID', data.data.user.uuid);
                                    if(data.data.user.photo_url) {
                                        saveDataToLocalStorage('selfstudyUserPhotoUrl', data.data.user.photo_url);
                                    }

                                    if(data.data.user.name) {
                                        saveDataToLocalStorage('selfstudyUserDisplayName', data.data.user.name);
                                    } else {
                                        saveDataToLocalStorage('selfstudyUserDisplayName', "User");
                                    }

                                    if(data.data.user.email) {
                                        saveDataToLocalStorage('selfstudyUserEmailId', data.data.user.email);
                                    }

                                    if(data.data.user.class_id > 0) {
                                        saveDataToLocalStorage('selfstudyUserClassId', data.data.user.class_id);
                                    }

                                    if(data.data.user.state_id > 0) {
                                        saveDataToLocalStorage('selfstudyUserStateId', data.data.user.state_id);
                                    }

                                    if(data.data.user.board_id > 0) {
                                        saveDataToLocalStorage('selfstudyUserBoardId', data.data.user.board_id);
                                    }

                                    if(data.data.user.phone_verified > 0) {
                                        saveDataToLocalStorage('selfstudyUserPhoneVerified', data.data.user.phone_verified);
                                    }

                                    registerToken();
                                    var cls = getDataFromLocalStorage('loginsource');

                                    if (data.data.status == 1) { //Register
                                        // userSubscribeForNotification();
                                        if(cls == 'downloadpdf' || cls == 'showmcqsolution') {
                                            if(!checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhoneVerified'))) {
                                                showPopupForToBePrime();
                                            }
                                        } else {
                                            $('#modalUserDetails').modal('show');
                                        }
                                    } else { //Login
                                        // $('#popupBody').html(data.data.message);
                                    }

                                    if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhoneVerified'))) {
                                        if(cls == 'showmcqsolution') {
                                            showMCQSolution();
                                        }
                                    } else {
                                        if(cls == 'downloadpdf') {
                                            showVerifyMobileMessageAndBtn();
                                        }
                                    }

                                    updateHeaderProfileView();
                                    setAndGetProfileComplitionPercentage();
                                } else {
                                    if (getDataFromLocalStorage('isFirebaseGoogleLoginInProgress')) {
                                        $('#popupBody').html(data.data.message);
                                    } else {
                                        showEmptyForm("", data.data.message, 0, 0, "OK", "", 0);
                                    }
                                }

                                console.log("Message => " + data.data.message);
                                showHideLoginPopupMessage(1, 1, data.data.message);
                                removeItemFromLocalStorage('isFirebaseGoogleLoginInProgress'); //We do not need to check if key exist
                                location.reload(); //this is done to reflect the new values on page
                            })
                            .fail(function( msg ) {
                                // isLoginInProgress = false;
                                deleteDataFromLocalForage('isLoginInProgress');
                                removeItemFromLocalStorage('isFirebaseGoogleLoginInProgress'); //We do not need to check if key exist

                                //console.log("Error Message =>" + JSON.stringify(msg));
                                $('#popupBody').html("Some Error occurred on Server, Try Again.");
                            });
                    }).catch(function(error) {
                        console.log('error', error);
                    });
                } else {
                    console.log('Login is already in progress');
                }
            })
                .catch(function(error) {
                    console.log('error:', error);
                });
        }
    }

    function userSubscribeForNotification() {
        var userUUID = getUserUUID();
        var catId = [{cat_id:0, class_id:0}];
        var params = "?application_id=com.selfstudys&user_firebase_id=" + userUUID + "&category_ids_json=" + JSON.stringify(catId);
        $.ajax({
            type: 'GET',
            url: "https://selfstudys.com:8081/api/v3/save-user-preference" + params,
            enctype: 'multipart/form-data',
            processData: false, // tell jQuery not to process the data
            contentType: false,
            data: {},
            success: function(responsedata, status, xhr) {
                //console.log('responsedata : ' + responsedata);
                var json = JSON.parse(responsedata);
                if (json.status == "success") {
                    //console.log('Your Preferences Saved Successfully.');
                } else {
                    //console.log('Not get Success.');
                }
            },
            error: function(responsedata) {
                //console.log(responsedata);
            },
        });
    }

    // $("#login").click(function() {
    //     var email = document.getElementById('email').value;
    //     var password = document.getElementById('password').value;
    //     if (email.length < 4) {
    //       showHideSuccessFailMessage(1,1,2,'Please enter a valid email address.');
    //       return;
    //     }
    //     if (password.length < 4) {
    //       showHideSuccessFailMessage(1,1,2,'Please enter a valid password.');
    //       return;
    //     }
    //     // Sign in with email and pass.
    //     // [START authwithemail]
    //     showHideSuccessFailMessage(1,1,1,'Authenticating Please Wait...');
    //     firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
    //       // Handle Errors here.
    //       var errorCode = error.code;
    //       var errorMessage = error.message;
    //       // [START_EXCLUDE]
    //       if (errorCode === 'auth/wrong-password') {
    //         showHideSuccessFailMessage(1,1, 2, 'Wrong password.');
    //       } else {
    //         showHideSuccessFailMessage(1,1, 2, errorMessage);
    //       }
    //       console.log(error);
    //       //document.getElementById('quickstart-sign-in').disabled = false;
    //     });
    //     //console.log("toggleSignIn email => " + email);
    // });

    // $("#register").on('click', function() {
    //     //console.log("handleSignUp Start");
    //     var fname = document.getElementById('fname').value;
    //     var lname = document.getElementById('lname').value;
    //     var email = document.getElementById('emailSignup').value;
    //     var password = document.getElementById('passwordSignup').value;

    //     // var cpassword = document.getElementById('cpassword').value;
    //     // if (password != cpassword) {
    //     //   showHideSuccessFailMessage(2,1, 2, 'Password and Confirm Password are not same');
    //     //   return;
    //     // }

    //     if (email.length < 4) {
    //       showHideSuccessFailMessage(2,1, 2, 'Please enter correct email address');
    //       return;
    //     }
    //     if (password.length < 4) {
    //       showHideSuccessFailMessage(2,1, 2, 'Min Password length is 4 character.');
    //       return;
    //     }

    //     showHideSuccessFailMessage(2,1, 1, 'Authenticating...');

    //     isSendVerificationMail = true;
    //     firstLastName = fname + " " + lname;

    //     firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
    //       var errorCode = error.code;
    //       var errorMessage = error.message;
    //       if (errorCode == 'auth/weak-password') {
    //         showHideSuccessFailMessage(2,1, 2, 'The password is too weak.');
    //       } else {
    //         showHideSuccessFailMessage(2,1, 2, errorMessage);
    //       }
    //       //console.log(error);
    //     });
    // });

    // $("#sendPwdRestLink").click(function() {
    //   var email = document.getElementById('emailForgetPassword').value;
    //   showHideSuccessFailMessage(3,1, 1, 'Sending Password Reset Link.');
    //   firebase.auth().sendPasswordResetEmail(email).then(function() {
    //     showHideSuccessFailMessage(3,1, 1, 'Password Reset Email Sent!');
    //   }).catch(function(error) {
    //     var errorCode = error.code;
    //     var errorMessage = error.message;
    //     if (errorCode == 'auth/invalid-email') {
    //       showHideSuccessFailMessage(3,1, 2, 'Invalid Email. Please enter correct Email Id');
    //       //console.log("invalid-email" + error);
    //     } else if (errorCode == 'auth/user-not-found') {
    //       showHideSuccessFailMessage(3,1, 2, 'User not found. Please Create Account.');
    //       //console.log("user-not-found" + error);
    //     } else {
    //       showHideSuccessFailMessage(3,1, 2, errorMessage);
    //     }
    //   });
    // });

    function prepareDataAndLogin() {
        if (firstLastName == null) {
            var displayName = currentFirebaseUser.displayName;
        } else {
            var displayName = firstLastName;
        }

        var providerData = JSON.stringify(currentFirebaseUser.providerData);
        var email = currentFirebaseUser.providerData[0].email;
        var emailVerified = currentFirebaseUser.emailVerified;
        var photoURL = currentFirebaseUser.providerData[0].photoURL;
        var isAnonymous = currentFirebaseUser.isAnonymous;
        var uid = currentFirebaseUser.uid;
        var mobile = currentFirebaseUser.providerData[0].phoneNumber;
        var providerId = currentFirebaseUser.providerData[0].providerId;

        var refreshToken = currentFirebaseUser.refreshToken;
        var created_at = currentFirebaseUser.metadata.a;
        var last_login = currentFirebaseUser.metadata.b;
        var applicationId = "com.selfstudys";

        loginRegisterToServer(uid, email, displayName, providerId, photoURL, applicationId);
    }

    $(document).on('click', '.login-with-google', function() {
        if (!firebase.auth().currentUser) {
            $('#loader-wrapper').removeClass('hideThis');
            var provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('https://www.googleapis.com/auth/plus.login');
            provider.addScope('https://www.googleapis.com/auth/userinfo.email');
            saveDataToLocalStorage('isFirebaseGoogleLoginInProgress', true);
            firebase.auth().signInWithRedirect(provider);
            // $('#loader-wrapper').addClass('hideThis');
        } else {
            //console.log(currentFirebaseUser);
        }
    });

    function initAppForGoogleSignIn() {
        firebase.auth().getRedirectResult().then(function(result) {
            // This gives you a Google Access Token. You can use it to access Google APIs. Currently we donot need it
            if (result.credential) {
                var token = result.credential.accessToken;
            } else {
                //console.log("User is Not LoggedIn");
            }
        }).catch(function(error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            var email = error.email;
            var credential = error.credential;

            //console.log("LoginError errorCode => " + errorCode);
            //console.log("LoginError errorMessage => " + errorMessage);
            //console.log("LoginError email => " + email);
            //console.log("LoginError credential => " + credential);

            if (errorCode === 'auth/account-exists-with-different-credential') {
                //console.log("You have already signed up with a different auth provider for that email.");
                showHideLoginPopupMessage(1, 2, 'You have already signed up with a different auth provider for that email.');
            } else {
                //console.log("error : " + errorMessage);
                showHideLoginPopupMessage(1,2,errorMessage);
            }
        });
    }

    // $(".login-with-fb").click(function() {
    //   if (!firebase.auth().currentUser) {
    //     $('#currentMsg').removeClass('alert-danger').addClass('alert alert-success').html('Authenticating...').show();
    //     var provider = new firebase.auth.FacebookAuthProvider();
    //     provider.addScope('public_profile');
    //     provider.addScope('user_friends');
    //     provider.addScope('email');
    //     firebase.auth().signInWithRedirect(provider);
    //   }
    //   console.log("login-with-google");
    // });

    // $(".login-with-twitter").click(function() {
    //   if (!firebase.auth().currentUser) {
    //     $('#currentMsg').removeClass('alert-danger').addClass('alert alert-success').html('Authenticating...').show();
    //     var provider = new firebase.auth.TwitterAuthProvider();
    //     firebase.auth().signInWithRedirect(provider);
    //   }
    //   console.log("login-with-google");
    // });

    // function sendFirstTimeEmailVerification() {
    //   firebase.auth().currentUser.sendEmailVerification().then(function() {
    //     showHideSuccessFailMessage(2,1, 1, 'Verification Email Sent!, Please Verify your email Id.');
    //     //showEmptyForm("Alert", "Verification Email Sent!, Please Verify your email Id.", 0, 0, "OK", "", 0);
    //     $('#popupBody').html('Verification Email Sent!, Please Verify your email Id.');
    //   });
    // }

    function showHideLoginPopupMessage(isShow, successOrFail, message) {
        var divElem = $('.loginPopupSuccessFailMessageDiv');
        divElem.addClass('hideThis');

        if(isShow == 1) {
            if(successOrFail == 1) {
                divElem.removeClass('alert-danger').addClass('alert alert-success');
            } else if(successOrFail == 2) {
                divElem.removeClass('alert-success').addClass('alert alert-danger');
            }

            divElem.html(message).removeClass('hideThis');
        }
    }

    // function showHideSuccessFailMessage(loginFormType, isShow, successOrFail, message) {
    //   $('.successFailMessageDiv').addClass('hideThis');
    //   var currElement = null;
    //   if (loginFormType == 1 && isShow == 1) {
    //     currElement = $('#successFailMessageLogin');
    //   } else if (loginFormType == 2 && isShow == 1) {
    //     currElement = $('#successFailMessageSignup');
    //   } else if (loginFormType == 3 && isShow == 1) {
    //     currElement = $('#successFailMessageForgetPWD');
    //   }

    //   if (currElement != null) {
    //     if(successOrFail == 1) {
    //       currElement.removeClass('alert-danger').addClass('alert alert-success');
    //     } else if(successOrFail == 2) {
    //       currElement.removeClass('alert-success').addClass('alert alert-danger');
    //     }
    //    currElement.html(message).removeClass('hideThis');
    //   }
    // }

    // function checkIfUserVerified() {
    //   const currentUser = firebase.auth().currentUser;
    //   if(currentUser) {
    //     currentUser.reload().then(() => {
    //       if (firebase.auth().currentUser.emailVerified) {
    //         //console.log("===>" + JSON.stringify(firebase.auth().currentUser));
    //         removeItemFromLocalStorage('selfstudyFirebaseIsVerified');
    //         removeItemFromLocalStorage('selfstudyFirebaseToken');

    //         currentFirebaseUser = firebase.auth().currentUser;
    //         prepareDataAndLogin();
    //       } else {
    //         $('#popupBody').html('It seems you have not verfied yet.');
    //       }
    //     })
    //   }
    // }

    function signInAnonymously() {
        firebase.auth().signInAnonymously()
            .then(() => {
                console.log('signInAnonymously success');
            })
            .catch((error) => {
                var errorCode = error.code;
                var errorMessage = error.message;
                console.log('signInAnonymously Error : ' + JSON.stringify(error));
            });
    }


    function handleOneTapLoginResponse(response) {
        showEmptyForm("", "Please Wait Login in progress...", 0, 0, "OK", "", 0);
        //saveDataToLocalStorage('isFirebaseGoogleLoginInProgress', true);
        let credential2 = firebase.auth.GoogleAuthProvider.credential(response.credential);
        firebase.auth().signInWithCredential(credential2);
    }

    window.onload = function() {
        if (getDataFromLocalStorage('isFirebaseGoogleLoginInProgress')) {
            showEmptyForm("", "Please Wait Login in progress...", 0, 0, "OK", "", 0);
        }

        firebase.auth().onAuthStateChanged(function(user) {
            // console.log('onAuthStateChanged Called');
            if(document.visibilityState === 'visible') {
                if (user) {
                    currentFirebaseUser = user;

                    //userIsLoggedIn();

                    prepareDataAndLogin();

                    // if(isSendVerificationMail) {
                    //   sendFirstTimeEmailVerification();
                    //   isSendVerificationMail = false;
                    // }

                    if (getDataFromLocalStorage('isFirebaseGoogleLoginInProgress')) { removeItemFromLocalStorage('isFirebaseGoogleLoginInProgress'); }
                } else {

                    //userIsNotLoggedIn();

                    //console.log('onAuthStateChanged ==> user is not logged in');
                    if (getDataFromLocalStorage('isFirebaseGoogleLoginInProgress')) {
                        removeItemFromLocalStorage('isFirebaseGoogleLoginInProgress');
                        $('#popupBody').html('Some Error occurred.');
                    }

                    // For Google One Tap
                    google.accounts.id.initialize({
                        client_id: '1090334648545-e4q293ihecinh0fsuqkquqf1a0sna6va.apps.googleusercontent.com',
                        callback: handleOneTapLoginResponse
                    });
                    google.accounts.id.prompt(); // Display the One Tap dialog
                }

                if(getDataFromLocalStorage('isUserCloseNotificationAskPopup') != 'yes') {
                    if(doWeNeedForAskingNotificationPermission()) {
                        setTimeout(() => {
                            $('#pushNotificationContainer').removeClass('hideThis');
                        }, 5000);
                    } else {
                        // console.log('NoNeedForShowingNotificationPopup');
                    }
                } else {
                    // console.log('NoQuotaForShowingNotificationPopup');
                }
            }
        });
    };

    function doWeNeedForAskingNotificationPermission() {
        // console.log('doWeNeedForAskingNotificationPermission');
        if (getDataFromLocalStorage("selfstudysTokenV4") == null) {
            return true;
        }
        if (getUserUUID() != null && getDataFromLocalStorage("isFCMTokenMAPToUserUUID") != 1) {
            return true;
        }

        return false;
    }

    if ( $(".askForWebNotificationDiv")[0] ) {
        if(doWeNeedForAskingNotificationPermission()) {
            $('.askForWebNotificationDiv').show();
        }

        $('#askForWebNotification').on('click', function() {
            requestPermission(2);
        });
    } else {
        // console.log('askForWebNotificationDiv 3');
    }

    $('#nPopupAllowBtn').on('click', function() {
        $('#pushNotificationContainer').addClass('hideThis');
        saveDataToLocalStorageWithExpiration('isUserCloseNotificationAskPopup', 'yes', 259200);
        requestPermission(2);
        sendResponseToServer(1);
    });

    $('#nPopupCancelBtn').on('click', function() {
        $('#pushNotificationContainer').addClass('hideThis');
        saveDataToLocalStorageWithExpiration('isUserCloseNotificationAskPopup', 'yes', 259200);
        sendResponseToServer(2);
    });

    function sendResponseToServer(userResponse) {
        var params = "?user_response=" + userResponse;
        $.ajax({
            type: 'GET',
            url: "/api/get-notification-popup-response" + params,
            processData: false, // tell jQuery not to process the data
            contentType: false,
            data: {},
            success: function(responsedata, status, xhr) {
                // console.log('responsedata : ' + responsedata);
            },
            error: function(responsedata) {
                // console.log(responsedata);
            },
        });
    }

    console.log('getCurrentPageClassId()', getCurrentPageClassId());
</script>
<!-- Modal Login/Signup -->
<div class="modal fade modal-new" id="modalLogin" tabindex="-1" aria-labelledby="modalLogin" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/logo-sm.svg" alt="" class="ms-auto">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="modal-title text-center mb-3 signupPopupClass" id="signuppopupHeaderTitle"> Sign up to your account</div>
                <div class="modal-title text-center mb-3 loginPopupClass hideThis">Log in to your account</div>

                <div class="px-5">
                    <div class="sign-google">
                        <a href="javascript:void(0);">
                            <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/google.svg" alt="">
                            <span class="signupPopupClass login-with-google">Sign Up with Google</span>
                            <span class="loginPopupClass login-with-google hideThis">Log in with Google</span>
                        </a>
                    </div>
                </div>

                <div class="loginPopupSuccessFailMessageDiv hideThis"></div>

                <div class="mt-2">
                    <div class="text-center loginPopupClass showSignupPopup hideThis">New to Selfstudy? <a href="javascript:void(0);">Sign Up</a></div>
                    <div class="text-center signupPopupClass showLoginPopup">Already have an account? <a href="javascript:void(0);">Log in</a></div>
                </div>

                <div class="footer-terms" style="margin-top: 40px;">
                    By clicking Log in/Sign Up, you agree to our <a href="/privacy-policy"> Terms of Use</a> & our <a href="/privacy-policy"> Privacy Policy</a>.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-new modal-new-fill" id="modalUserDetails" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/logo-sm.svg" alt="" class="ms-auto">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="modal-title text-center mb-3">Get personalized exam alerts and access study materials made just for you.</div>

                <form>
                    <div class="form-group" id="udNameFormGroup">
                        <input type="text" class="form-control" placeholder="Name*" id="udUsername">
                    </div>

                    <div class="form-group" id="udPhoneFormGroup">
                        <input type="number" class="form-control" placeholder="Mobile no*" id="udPhonenumber" min="1000000000" max="9999999999" maxlength="10" minlength="10" oninput="limitNumberLength(this)">
                    </div>

                    <div class="form-group position-relative" id="udClassFormGroup">
                        <div class="classDropdown">
                            <button class="btn dropdown-toggle mttoc" type="button" data-bs-toggle="dropdown">Select Class*</button>
                            <div class="dropdown-menu p-2">
                                <div class="drop-search position-relative">
                                    <input type="text" name="search" class="form-control mb-2" id="classInputField">
                                </div>
                                <div id="userDetailsPopupClass"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group position-relative hideThis" id="udStreamFormGroup">
                        <div class="streamDropdown">
                            <button class="btn dropdown-toggle mttoc" type="button" data-bs-toggle="dropdown">Select Stream</button>
                            <div class="dropdown-menu p-2">
                                <div class="drop-search position-relative">
                                    <input type="text" name="search" class="form-control mb-2" id="streamInputField">
                                </div>
                                <div id="userDetailsPopupStream"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group position-relative hideThis" id="udBoardFormGroup">
                        <div class="boardDropdown">
                            <button class="btn dropdown-toggle mttoc" type="button" data-bs-toggle="dropdown">Select Board</button>
                            <div class="dropdown-menu p-2">
                                <div class="drop-search position-relative">
                                    <input type="text" name="search" class="form-control mb-2" id="boardInputField">
                                </div>
                                <div id="userDetailsPopupBoard"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group position-relative hideThis" id="udStateFormGroup">
                        <div class="stateDropdown">
                            <button class="btn dropdown-toggle mttoc" type="button" data-bs-toggle="dropdown">Select State</button>
                            <div class="dropdown-menu p-2">
                                <div class="drop-search position-relative">
                                    <input type="text" name="search" class="form-control mb-2" id="stateInputField">
                                </div>
                                <div id="userDetailsPopupState"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group position-relative hideThis" id="udCityFormGroup">
                        <div class="cityDropdown">
                            <button class="btn dropdown-toggle mttoc" type="button" data-bs-toggle="dropdown">Select City</button>
                            <div class="dropdown-menu p-2">
                                <div class="drop-search position-relative">
                                    <input type="text" name="search" class="form-control mb-2" id="cityInputField">
                                </div>
                                <div id="userDetailsPopupCity"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="checkbox" id="userdataTandC1" checked>
                        I agree to the <a href="/privacy-policy"> Terms of Use</a> & <a href="/privacy-policy"> Privacy Policy</a>
                    </div>

                    <div class="form-group position-relative alert alert-danger error-msg hideThis" role="alert"></div>


                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-red" id="saveUserProfileBtn">Save</button>
                        <button type="button" class="btn btn-secondary btn-red hideThis" id="saveSingleInfoBtn">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-new modal-prime" id="modalLoginMobile" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/logo-sm.svg" alt="" class="ms-auto mobileVerifyDLogo hideThis">
                <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/logo-prime.png" alt="" class="ms-auto popupPrimeFeature hideThis">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="modal-title text-center mb-3 signupPopupClass hideThis">Sign up to your account</div>
                <div class="modal-title text-center mb-3 loginPopupClass hideThis">Log in to your account</div>
                <div class="modal-title text-center mb-3 vmnClass hideThis">Varify Mobile Number</div>

                <ul class="prime-list popupPrimeFeature hideThis">
                    <li>
                        <div class="p-li-title">Unlimited Access to PDFs:</div>
                        <p>Provide prime members with unlimited access to all study materials in PDF format.</p>
                    </li>

                    <li>
                        <div class="p-li-title">Multiple Attempts in MCQ Tests:</div>
                        <p>Allow prime members to attempt MCQ tests multiple times to enhance their learning and understanding.</p>
                    </li>
                    <li>
                        <div class="p-li-title">Exclusive Premium Content Access.</div>
                        <p>Provide prime users with access to exclusive PDF study materials that are not available to regular users.</p>
                    </li>
                </ul>

                <div class="mt-3 text-center mb-3 verify-prime popupPrimeFeature hideThis">
                    Verify your mobile number to become <br> <strong>FREE PRIME MEMBER.</strong>
                </div>

                <div class="px-5 text-center mb-3 otpSentImageDiv">
                    <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/otp-sent.svg" alt="">
                </div>

                <form>
                    <div class="form-group">
                        <input type="number" class="form-control" placeholder="Enter Your mobile number" min="1000000000" max="9999999999" maxlength="10" id="loginMobileNumber" oninput="limitNumberLength(this)">
                    </div>

                    <div class="form-group position-relative alert alert-danger error-msg hideThis" role="alert"></div>

                    <div class="text-center">
                        <button type="button" class="btn btn-secondary generateOTPBtn">Send OTP</button>
                    </div>
                    <div class="text-center signupPopupClass showLoginPopup hideThis">Already have an account <a href="javascript:void(0);">Log in</a></div>
                    <div class="text-center loginPopupClass showSignupPopup hideThis">New to Selfstudy? <a href="javascript:void(0);">Sign Up</a></div>
                </form>

                <div class="footer-terms" style="margin-top: 40px;">
                    By Sending OTP, you agree to our <a href="/privacy-policy"> Terms of Use</a> & our <a href="/privacy-policy"> Privacy Policy</a>.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-new modal-new-fill" id="modalValidatingOTP" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/logo-prime.png" class="ms-auto">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="modal-title text-center mb-3">Varify Mobile Number</div>
                <div class="px-5 text-center mb-3">
                    <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/otp-fill.svg" alt="">
                    <div class="otp-line">
                        Please enter verification code sent to <strong class="currMobileNumber"></strong>
                        <a href="javascript:void(0);" id="changeCurrMobileNumber">
                            <img src="https://www.selfstudys.com/viewncert/design-april-2022/images/pencil.svg">
                        </a>
                    </div>
                </div>

                <form>
                    <div class="form-group row g-2 otp-area">
                        <div class="col"><input type="text" class="form-control text-center" id='totp1' maxlength="1" placeholder="*"></div>
                        <div class="col"><input type="text" class="form-control text-center" id='totp2' maxlength="1" placeholder="*"></div>
                        <div class="col"><input type="text" class="form-control text-center" id='totp3' maxlength="1" placeholder="*"></div>
                        <div class="col"><input type="text" class="form-control text-center" id='totp4' maxlength="1" placeholder="*"></div>
                    </div>

                    <div class="form-group position-relative alert alert-danger error-msg hideThis" role="alert"></div>

                    <div class="otp-line text-center mb-2">
                        Didn't Recieve the code?
                        <a href="javascript:void(0);" class="reGenerateOTPBtn">Resend</a>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="loginVerifyOTP">Verify</button>
                    </div>
                </form>

                <div class="footer-terms" style="margin-top: 40px;">
                    By clicking Verify, you agree to our <a href="/privacy-policy"> Terms of Use</a> & our <a href="/privacy-policy"> Privacy Policy</a>.
                </div>
            </div>
        </div>
    </div>
</div>

<div id="user-profile-completed-footer" style="position: fixed; bottom: 0; left: 0; width: 100%; background: #09bd80; color: white; padding: 7px;height:45px;" class="hideThis">
    <a class="hideItsParent" style="color:white;position:absolute;top:-10px;left:0;padding:5px;background-color:black;border-radius:50%;width:20px;height:20px;text-align:center;line-height:8px;">x</a>
    <span style="float:left;color:white;font-size:13px;padding-top:7px;" id="complete-profile-bottom-span">Profile Completed: 0%</span>
    <a id="complete-profile-bottom-link" href="javascript:void(0);" style="float: right; background: #FECE00; color: black; padding: 5px 20px 5px 10px; font-size: 12px; border-radius: 50px; display: inline-block; text-decoration: none;" data-source="bottomcompleteprofilebtn">Complete Profile </a>
</div>

<script>
    const $loginPopup           = $('.loginPopupClass');
    const $signupPopup          = $('.signupPopupClass');
    let selectedClassId         = 0;
    let selectedStreamId        = 0;
    let selectedBoardId         = 0;
    let selectedStateId         = 0;
    let selectedCityId          = 0;
    let isMobileVerifyOrLogin   = 0;
    let local_class_exams, local_boards, local_states, local_cities;
    let localClassExams, localBoards, localStates, localCities;
    let userProfileClass,userProfileStream,userProfileBoard,userProfileState,userProfileCity;
    var currMobileNumber;
    var dailyClickKeyConfig = { 'pdfclicks': 'askLoginForPDF', 'testclicks': 'askLoginForTest' };

    function showLoginPopup(loginsource, buttonRef) {
        logoutUser(0);
        console.log("showLoginFormForDownloadPDF, loginsource: " + loginsource + " ; buttonRef", buttonRef);
        saveDataToLocalStorage('loginsource', loginsource);

        if(loginsource == 'downloadpdf') {
            buttonRef.html('Please Wait...');
            $('.signInH2Div').html('Sign in to <span class="text-danger">Download PDF</span>');
            $('.signInPara').html('Get Free Study materials For all classes.');
        } else if(loginsource == 'starttest') {
            $('#signuppopupHeaderTitle').html('Login to Know Your All-India Test Rank & Result Analysis');
        }

        $('#modalLogin').modal('show');
    }

    function convertUnicodeToString(name) {
        const unicodeToAsciiMapping = {
            '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'ae', '': 'c', '': 'c', '': 'c', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'i', '': 'i', '': 'i', '': 'i', '': 'i', '': 'i', '': 'i', '': 'ij', '': 'd', '': 'l', '': 'n', '': 'n', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'oe', '': 'r', '': 's', '': 's', '': 'ss', '': 't', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u'
        };

        let asciiString = name.split('').map(function(char) {
            return unicodeToAsciiMapping[char.toLowerCase()] || (char.charCodeAt(0) < 128 ? char : '');
        }).join('');

        return asciiString;
    }

    $(document).on('click', '.showSignupPopup', function() {
        if ($(this).attr('data-source') !== undefined) {
            saveDataToLocalStorage('loginsource', $(this).data('source'));
        }

        $signupPopup.removeClass('hideThis');
        $loginPopup.addClass('hideThis');
        $('#modalLogin').modal('show');
    });

    $(document).on('click', '.showLoginPopup', function() {
        if ($(this).attr('data-source') !== undefined) {
            saveDataToLocalStorage('loginsource', $(this).data('source'));
        }

        hideEmptyForm();
        $signupPopup.addClass('hideThis');
        $loginPopup.removeClass('hideThis');
        $('#modalLogin').modal('show');
    });

    function setAndGetProfileComplitionPercentage() {
        var totalPerc = 0;
        if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserDisplayName'))) { totalPerc = totalPerc + 20; }
        if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserClassId'))) { totalPerc = totalPerc + 20; }
        if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserStateId'))) { totalPerc = totalPerc + 20; }
        if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserBoardId'))) { totalPerc = totalPerc + 20; }
        if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhoneVerified'))) { totalPerc = totalPerc + 20; }

        $('#complete-profile-bottom-span').html('Profile Completed: ' + totalPerc + '%');
        return totalPerc;
    }

    function createSelectBoxItem(itemName, itemValue, itemClass) {
        return "<a class='dropdown-item " + itemClass + "' href='javascript:void(0);' data-value='" + itemValue + "'>" + itemName + "</a>";
    }

    function saveUserProfileData(step) {
        const uuid = getUserUUID();
        const username = $('#udUsername').val();
        const phonenumber = $('#udPhonenumber').val();

        if(step == 2 && username.length == 0) {
            $('.error-msg').html('Please Enter your name.').removeClass('hideThis alert-success').addClass('alert-danger');
            return;
        }

        if(step == 2 && (phonenumber.length !== 10 || isNaN(phonenumber))) {
            $('.error-msg').html('Please enter a 10-digit phone number.').removeClass('hideThis alert-success').addClass('alert-danger');
            return;
        }

        if(step == 2 && selectedClassId == 0) {
            $('.error-msg').html('Please Select Class.').removeClass('hideThis alert-success').addClass('alert-danger');
            return;
        }

        if(step == 2 && !$('#userdataTandC1').is(':checked')) {
            $('.error-msg').html('Please accept the Terms of Use & Privacy Policy.').removeClass('hideThis alert-success').addClass('alert-danger');
            return;
        }

        if(checkIfValueIsCorrect(getUserUUID())) {
            updateUserProfileToServer(getUserUUID(), username, phonenumber, selectedClassId, selectedStreamId, selectedBoardId, selectedStateId, selectedCityId, '', '')
                .then(function(data) {
                    console.log('Update successful:', data);
                    if (data.status == "success") { }
                    if(step == 2) {
                        $('#modalUserDetails').modal('hide');
                        showEmptyForm("Alert", data.data.message, 0, 0, "OK", "", 0);
                    }
                })
                .catch(function(error) {
                    $('#modalUserDetails').modal('hide');
                    // console.log('Error: ', error);
                    showEmptyForm("Error", "Error in saving Profile Information...", 0, 0, "OK", "", 0);
                });
        }
    }

    $(document).on('click', '#saveUserProfileBtn', function(e) {
        e.preventDefault();
        $('.error-msg').addClass('hideThis');

        saveUserProfileData(2);
    });

    function activateSendOtpBtn() {
        if($('#loginMobileNumber').val().length > 9) {
            $('.generateOTPBtn').removeClass('btn-secondary').addClass('btn-primary');
        }
    }

    $(document).on('click', '#changeCurrMobileNumber', function(e) {
        $('#modalValidatingOTP').modal('hide');
        $('#modalLoginMobile').modal('show');
        activateSendOtpBtn();
    });

    $(document).on('click', '.verifyMobileNumberBtn', function(e) {
        isMobileVerifyOrLogin = 1;
        $('.vmnClass, .mobileVerifyDLogo').removeClass('hideThis');
        $('.signupPopupClass, .loginPopupClass').addClass('hideThis');
        $('#modalLoginMobile').modal('show');
        activateSendOtpBtn();
    });

    function showPopupForToBePrime() {
        isMobileVerifyOrLogin = 1;
        $('.popupPrimeFeature').removeClass('hideThis');
        $('.signupPopupClass, .loginPopupClass, .otpSentImageDiv').addClass('hideThis');
        $('#modalLoginMobile').modal('show');
        activateSendOtpBtn();
    }

    $(document).on('click', '.applyToPrimeBtn', function(e) {
        e.preventDefault();
        showPopupForToBePrime();
    });

    $(document).on('click', '.loginSignupUsingMobile', function(e) {
        isMobileVerifyOrLogin = 2;
        $('.vmnClass, .loginPopupClass').addClass('hideThis');
        $('.signupPopupClass, .mobileVerifyDLogo').removeClass('hideThis');
        $('#modalLoginMobile').modal('show');
        activateSendOtpBtn();
    });

    $(document).on('click', '.generateOTPBtn', function(e) {
        generateOTP(e, 1);
    });

    $(document).on('click', '.reGenerateOTPBtn', function(e) {
        generateOTP(e, 2);
    });

    function generateOTP(e, source) {
        if(checkIfValueIsCorrect(getUserUUID())) {
            if(checkIfValueIsCorrect(e)) { e.preventDefault(); }
            $('.error-msg').addClass('hideThis');

            if ($('#loginMobileNumber').length && checkIfValueIsCorrect($('#loginMobileNumber').val())) {
                currMobileNumber = $('#loginMobileNumber').val();
            } else if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhone'))) {
                currMobileNumber = getDataFromLocalStorage('selfstudyUserPhone');
            }

            if(checkIfValueIsCorrect(currMobileNumber)) {
                var otpData = '{"mobile_number":"' + currMobileNumber + '","app_hash":"selfstudys.com"}';
                const payload = {'application_id': 'com.selfstudys', 'uuid': getUserUUID(), 'otp_data': otpData };

                $.ajax({
                    method: 'POST',
                    url: "https://topcoaching.in/api/generate-otp-for-login-v2",
                    dataType: 'json',
                    data: payload
                })
                    .done(function(data) {
                        console.log('responsedata: ', data);
                        if (data.status == "success") {
                            if (data.data.status == 1) {
                                if(source == 1) {
                                    $('#modalLoginMobile').modal('hide');
                                    $('.currMobileNumber').html(currMobileNumber);
                                    $('#modalValidatingOTP').modal('show');
                                } else if(source == 2) {
                                    $('.error-msg').html("The code has been resent.").removeClass('alert-danger hideThis').addClass('alert-success');
                                }
                            } else {
                                $('.error-msg').html(data.data.message).removeClass('hideThis alert-success').addClass('alert-danger');
                            }
                        } else {
                            $('.error-msg').html(data.data.message).removeClass('hideThis alert-success').addClass('alert-danger');
                        }
                    })
                    .fail(function( jqXHR, textStatus, error ) {
                        console.log('Error: ', error);
                        $('.error-msg').html('Error in generating OTP...').removeClass('hideThis alert-success').addClass('alert-danger');
                    });
            } else {
                $('.error-msg').html('Please enter mobile number.').removeClass('hideThis alert-success').addClass('alert-danger');
            }
        }
    }

    $('#loginVerifyOTP').on('click', function() {
        var otpNumber1 = $('#totp1').val();
        var otpNumber2 = $('#totp2').val();
        var otpNumber3 = $('#totp3').val();
        var otpNumber4 = $('#totp4').val();

        if (!otpNumber1 || !otpNumber2 || !otpNumber3 || !otpNumber4) {
            alert('Please Enter OTP');
            return;
        }

        const payload = {'application_id': 'com.selfstudys', 'device_type': 2, 'app_version': 1, 'phone_verified': currMobileNumber, 'user_submitted_otp': + otpNumber1 + otpNumber2 + otpNumber3 + otpNumber4 };

        var postUrl;
        if(isMobileVerifyOrLogin == 1 || isMobileVerifyOrLogin == 3) {
            const uuid = getUserUUID();
            payload.uuid = uuid;
            postUrl  = "https://topcoaching.in/api/update-phone-verified";
        } else if(isMobileVerifyOrLogin == 2) {
            postUrl  = "https://topcoaching.in/api/validate-otp-for-login-v2";
        }

        if(checkIfValueIsCorrect(postUrl)) {
            $.ajax({
                method: 'POST',
                url: postUrl,
                dataType: 'json',
                data: payload
            })
                .done(function(data) {
                    console.log('responsedata: ', data);
                    console.log('isMobileVerifyOrLogin: ', isMobileVerifyOrLogin);
                    if (data.status == "success") {
                        // $('#modalValidatingOTP').modal('hide');
                        // showEmptyForm("Alert", data.data.message, 0, 0, "OK", "", 0);

                        if(isMobileVerifyOrLogin == 1 || isMobileVerifyOrLogin == 3) { //VerifyThePhoneNumber
                            if (data.data.status > 0) {
                                $('#modalValidatingOTP').modal('hide');
                                saveDataToLocalStorage('selfstudyUserPhoneVerified', currMobileNumber);
                                $('.verifyMobileNumberBtn').addClass('hideThis');

                                if(checkIfValueIsCorrect(getDataFromLocalStorage('loginsource'))) {
                                    const cls = getDataFromLocalStorage('loginsource');

                                    if(cls == 'downloadpdf') {
                                        sendEmailToDownloadPDF(1);
                                    } else if(cls == 'showmcqsolution') {
                                        showMCQSolution();
                                    } else {
                                        showEmptyForm("Alert", data.data.message, 0, 0, "OK", "", 0);
                                    }
                                } else {
                                    showEmptyForm("Alert", data.data.message, 0, 0, "OK", "", 0);
                                }

                                // Check if we need this
                                // if(isMobileVerifyOrLogin == 1) {
                                //     window.location.href = "https://www.selfstudys.com/user/profile";
                                // }
                            } else {
                                $('.error-msg').html(data.data.message).removeClass('hideThis alert-success').addClass('alert-danger');
                            }
                        } else if(isMobileVerifyOrLogin == 2) { //LoginUsingMobileNumber
                            if(data.data.status > 0) {
                                $('#modalValidatingOTP').modal('hide');
                                showEmptyForm("Alert", data.data.message, 0, 0, "OK", "", 0);

                                saveDataToLocalStorage('selfstudyUUID', data.data.user.uuid);
                                if(data.data.user.photo_url) { saveDataToLocalStorage('selfstudyUserPhotoUrl', data.data.user.photo_url); }
                                if(data.data.user.name) { saveDataToLocalStorage('selfstudyUserDisplayName', data.data.user.name); } else { saveDataToLocalStorage('selfstudyUserDisplayName', "User"); }
                                if(data.data.user.email) { saveDataToLocalStorage('selfstudyUserEmailId', data.data.user.email); }
                                registerToken();

                                if (data.data.status == 1) { //Register
                                    userSubscribeForNotification();
                                    hideEmptyForm();

                                    $('#modalUserDetails').modal('show');
                                } else { //Login
                                    // hideEmptyForm(); // Auto Hide popup
                                    $('#popupBody').html(data.data.message);
                                }
                                updateHeaderProfileView();
                            } else {
                                $('.error-msg').html(data.data.message).removeClass('hideThis alert-success').addClass('alert-danger');
                            }
                        }
                    } else {
                        console.log('Not get Success.');
                    }
                })
                .fail(function( jqXHR, textStatus, error ) {
                    console.log('Error: ', error);
                    $('.error-msg').html('Error in generating OTP...').removeClass('hideThis alert-success').addClass('alert-danger');
                });
        }
    });

    $('#modalUserDetails').on('shown.bs.modal', function() {
        $(this).find('.mttoc').click(function() {
            $(this).closest('.modal-body').animate({
                scrollTop: $(this).offset().top - 50
            }, 500);

            return false;
        });
    });

    //Check where is this function used, if not used now then delete it
    // function updateUserProfile(userName, phoneNumber, classId, boardId, stateId, cityId, gender, dateOfBirth) {
    //     const uuid = getUserUUID();

    //     if(checkIfValueIsCorrect(uuid)) {
    //         if(checkIfValueIsCorrect(userName) || checkIfValueIsCorrect(phoneNumber) || checkIfValueIsCorrect(classId) || checkIfValueIsCorrect(boardId) || checkIfValueIsCorrect(stateId) || checkIfValueIsCorrect(cityId) || checkIfValueIsCorrect(gender) || checkIfValueIsCorrect(dateOfBirth) ) {

    //             let payload = { 'application_id': 'com.selfstudys', 'uuid': uuid, 'app_version': 1 };

    //             if(checkIfValueIsCorrect(userName)) {
    //                 payload.name = userName;
    //             }
    //             if(checkIfValueIsCorrect(phoneNumber)) {
    //                 payload.phone = phoneNumber;
    //             }
    //             if(checkIfValueIsCorrect(classId)) {
    //                 payload.class_id = classId;
    //             }
    //             if(checkIfValueIsCorrect(boardId)) {
    //                 payload.board_id = boardId;
    //             }
    //             if(checkIfValueIsCorrect(stateId)) {
    //                 payload.state_id = stateId;
    //             }
    //             if(checkIfValueIsCorrect(cityId)) {
    //                 payload.city_id = cityId;
    //             }
    //             if(checkIfValueIsCorrect(gender)) {
    //                 payload.gender = gender;
    //             }
    //             if(checkIfValueIsCorrect(dateOfBirth)) {
    //                 payload.dob = dateOfBirth;
    //             }

    //             $.ajax({
    //                 method: 'POST',
    //                 url: "https://topcoaching.in/api/update-user-profile-v2",
    //                 dataType: 'json',
    //                 data: payload
    //             })
    //             .done(function(data) {
    //                 if (data.status == "success") {
    //                     saveDataToLocalStorage('selfstudyUserDisplayName', data.data.user.name);
    //                     saveDataToLocalStorage('selfstudyUserPhone', data.data.user.phone);
    //                     saveDataToLocalStorage('selfstudyUserPhoneVerified', data.data.user.phone_verified);
    //                     saveDataToLocalStorage('selfstudyUserClassId', data.data.user.class_id);
    //                     saveDataToLocalStorage('selfstudyUserBoardId', data.data.user.board_id);
    //                     saveDataToLocalStorage('selfstudyUserStateId', data.data.user.state_id);
    //                     saveDataToLocalStorage('selfstudyUserCityId', data.data.user.city_id);
    //                 }
    //             })
    //             .fail(function( jqXHR, textStatus, error ) {
    //                 // console.log('Error: ', error);
    //             });

    //         }
    //     }
    // }

    function cleanUpOldKeys(todayKey) {
        localforage.keys().then(function(keys) {
            keys.forEach(function(key) {
                var isMatch = Object.keys(dailyClickKeyConfig).some(function(prefix) {
                    return key.startsWith(prefix + '_');
                });

                var reqIndex = key.indexOf('_');
                if(isMatch) {
                    console.log('isMatch: ' + isMatch + " ; todayKey: " + todayKey + " ; 2-> " + key.substring(reqIndex + 1));
                }

                if (isMatch && key.substring(reqIndex + 1) !== todayKey) {
                    localforage.removeItem(key).catch(function(err) {
                        console.error(err);
                    });
                }
            });
        }).catch(function(err) {
            console.error(err);
        });
    }

    function incrementDailyClickCount(storageKeyBase, callback) {
        let today = new Date().toISOString().split('T')[0].replace(/-/g, '_');
        let storageKey = storageKeyBase + '_' + today;

        cleanUpOldKeys(today);

        localforage.getItem(storageKey).then(function(clickCount) {
            if (clickCount === null) { clickCount = 1; } else { clickCount += 1; }
            localforage.setItem(storageKey, clickCount).then(function() {
                callback(clickCount);
            });
        }).catch(function(err) {
            console.error(err);
        });
    }

    function getLocationByIpAddress() {
        return new Promise((resolve, reject) => {
            // getClientIpAddress()
            //     .then(function(ipdata) {
            //         // console.log('ipdata', ipdata);
            //         var ipaddress = ipdata.data.data.ip;
            //         // console.log('ipaddress', ipaddress);

            //         // const getReq = "https://ipinfo.io/" + ipaddress + "/json";

            //     })
            //     .catch(function(error) {
            //         console.log('getClientIpAddress error:', error);
            //         reject(error);
            //     });

            const getReq = "https://pro.ip-api.com/json?key=4LyQVxEeCh2dheZ";
            performGETRequest(getReq, {}, false)
                .then(function(locationData) {
                    // console.log('serverData', locationData);
                    // console.log('country', locationData.country);
                    // console.log('city', locationData.city);
                    // console.log('state', locationData.regionName);
                    resolve(locationData);
                })
                .catch(function(error) {
                    reject(error);
                });
        });
    }

    // function getClientIpAddress() {
    //     return new Promise((resolve, reject) => {
    //         getDataFromLocalForage('client_ip_address')
    //             .then(function(ip_address_with_timestamp) {
    //                 if (ip_address_with_timestamp !== null && !isOldEnough(ip_address_with_timestamp, 86400)) {
    //                     resolve(ip_address_with_timestamp);
    //                 } else {
    //                     performGETRequest("https://selfstudys.com:8083/api/v9/gk/get-ip-address", {}, true)
    //                         .then(function(serverData) {
    //                             if(serverData.status == 'success') {
    //                                 const dataToStore = {
    //                                     timestamp: new Date().getTime(),
    //                                     data: serverData,
    //                                 };

    //                                 saveDataToLocalForage('client_ip_address', dataToStore)
    //                                     .then(function(localSavedData) {
    //                                         console.log('getClientIpAddress localSavedData:', localSavedData);
    //                                         resolve(localSavedData);
    //                                     })
    //                                     .catch(function(error) {
    //                                         console.log('getClientIpAddress error:', error);
    //                                         reject('getClientIpAddress error', error);
    //                                     });
    //                             }

    //                         });
    //                 }
    //             });
    //     });
    // }

    function getProfileBasicData() {
        return new Promise((resolve, reject) => {
            localforage.getItem('profilebasicdata')
                .then(function(basic_data) {
                    // console.log('getProfileBasicData basic_data', basic_data);
                    if (basic_data !== null && basic_data.data.version >= 2) {
                        resolve(basic_data);
                    } else {
                        performGETRequest("https://topcoaching.in/api/get-profile-basic-data", {}, true)
                            .then(function(basic_data) {
                                console.log('performGETRequest basic_data', basic_data);
                                localforage.setItem('profilebasicdata', basic_data)
                                    .then(function() {
                                        resolve(basic_data);
                                    })
                                    .catch(function(err) {
                                        reject('Error saving ProfileBasicData', err);
                                    });
                            })
                            .catch(reject); // Reject the outer promise with the error from the server request
                    }
                })
                .catch(function(err) {
                    reject('Error in getting profileBasicDataFromLocal', err);
                });
        });
    }

    function createSelectBoxItemCompleteProfileForm(itemValue, itemName, isSelected) {
        var isSelectedMarked = '';
        if(isSelected) { isSelectedMarked = ' selected'; }
        return '<option value="' + itemValue + '"' + isSelectedMarked + '>' + itemName + '</option>';
    }

    function saveUserProfileInfoToLocalStorage(name, phone, phone_verified, class_id, stream_id, board_id, state_id, city_id, gender, dob) {
        if (checkIfValueIsCorrect(name)) { saveDataToLocalStorage('selfstudyUserDisplayName', name); }
        if (checkIfValueIsCorrect(phone)) { saveDataToLocalStorage('selfstudyUserPhone', phone); }
        if (checkIfValueIsCorrect(phone_verified)) { saveDataToLocalStorage('selfstudyUserPhoneVerified', phone_verified); }

        if (checkIfValueIsCorrect(class_id) && class_id > 0) { saveDataToLocalStorage('selfstudyUserClassId', class_id); }
        if (checkIfValueIsCorrect(stream_id) && stream_id > 0) { saveDataToLocalStorage('selfstudyUserStreamId', stream_id); }
        if (checkIfValueIsCorrect(board_id) && board_id > 0) { saveDataToLocalStorage('selfstudyUserBoardId', board_id); }
        if (checkIfValueIsCorrect(state_id) && state_id > 0) { saveDataToLocalStorage('selfstudyUserStateId', state_id); }
        if (checkIfValueIsCorrect(city_id) && city_id > 0) { saveDataToLocalStorage('selfstudyUserCityId', city_id); }

        if (checkIfValueIsCorrect(gender) && gender > 0) { saveDataToLocalStorage('selfstudyUserGender', gender); }
        if (checkIfValueIsCorrect(dob)) { saveDataToLocalStorage('selfstudyUserDOB', dob); }

        getProfileBasicData()
            .then(function(basic_data) {
                if (checkIfValueIsCorrect(class_id) && class_id > 0) {
                    $.each(basic_data.data.class_exams, function(index, item) { if (item.id == class_id) { saveDataToLocalStorage('selfstudyUserClassName', item.title); return false; } });
                }
                if (checkIfValueIsCorrect(stream_id) && stream_id > 0) {
                    $.each(basic_data.data.class_exams, function(index, item) { if (item.id == stream_id) { saveDataToLocalStorage('selfstudyUserStreamName', item.title); return false; } });
                }
                if (checkIfValueIsCorrect(board_id) && board_id > 0) {
                    $.each(basic_data.data.boards, function(index, item) { if (item.id == board_id) { saveDataToLocalStorage('selfstudyUserBoardName', item.title); return false; } });
                }
                if (checkIfValueIsCorrect(state_id) && state_id > 0) {
                    $.each(basic_data.data.states, function(index, item) { if (item.id == state_id) { saveDataToLocalStorage('selfstudyUserStateName', item.title); return false; } });
                }
                if (checkIfValueIsCorrect(city_id) && city_id > 0) {
                    $.each(basic_data.data.cities, function(index, item) { if (item.id == city_id) { saveDataToLocalStorage('selfstudyUserCityName', item.title); return false; } });
                }
            });
    }

    function updateUserProfileToServer(uuid, name, phone, class_id, stream_id, board_id, state_id, city_id, gender, dob) {
        const payload = {'application_id': 'com.selfstudys', 'app_version': 1 , 'uuid': uuid};

        if (checkIfValueIsCorrect(name)) { payload.name = name; }
        if (checkIfValueIsCorrect(phone)) { payload.phone = phone; }
        if (checkIfValueIsCorrect(board_id) && board_id > 0) { payload.board_id = board_id; }
        if (checkIfValueIsCorrect(state_id) && state_id > 0) { payload.state_id = state_id; }
        if (checkIfValueIsCorrect(city_id) && city_id > 0) { payload.city_id = city_id; }
        if (checkIfValueIsCorrect(gender) && gender > 0) { payload.gender = gender; }
        if (checkIfValueIsCorrect(dob)) { payload.dob = dob; }

        if (checkIfValueIsCorrect(stream_id) && stream_id > 0) {
            payload.class_id = stream_id;
        } else if (checkIfValueIsCorrect(class_id) && class_id > 0) {
            payload.class_id = class_id;
        }

        return new Promise(function(resolve, reject) {
            $.ajax({
                method: 'POST',
                url: "https://topcoaching.in/api/update-user-profile-v2",
                dataType: 'json',
                data: payload
            })
                .done(function(serverUserData) {
                    if (serverUserData.status === "success") {
                        if(serverUserData.data.status > 0) {
                            saveUserProfileInfoToLocalStorage(serverUserData.data.user.name, serverUserData.data.user.phone, serverUserData.data.user.phone_verified, class_id, stream_id, serverUserData.data.user.board_id, serverUserData.data.user.state_id, serverUserData.data.user.city_id, serverUserData.data.user.gender, serverUserData.data.user.dob);
                            resolve(serverUserData);
                        } else {
                            reject(new Error("Update failed. " + serverUserData.data.message));
                        }
                    } else {
                        reject(new Error("Update failed"));
                    }
                })
                .fail(function(jqXHR, textStatus, error) {
                    console.log('Error: ', error);
                    reject(new Error("AJAX request failed"));
                });
        });
    }

    $('#saveCompleteProfileFormData').click(function(event) {
        event.preventDefault();

        var name = $('#cpfName').val();
        var mobile = $('#cpfMobile').val();
        var classId = $('#cpfClass').val();
        var streamId = $('#cpfStream').val();
        var boardId = $('#cpfBoard').val();
        var stateId = $('#cpfState').val();
        var cityId = $('#cpfCity').val();
        var agreeTerms = $('#cpfTandC').is(':checked');

        // if (name === '') { alert('Please enter your name.'); return; }
        // if (mobile === '') { alert('Please enter your mobile number.'); return; }
        // if (classId === '0') { alert('Please select a class.'); return; }
        // if (streamId === '0') { alert('Please select a stream.'); return; }
        // if (boardId === '0') { alert('Please select a board.'); return; }
        // if (stateId === '0') { alert('Please select a state.'); return; }
        // if (cityId === '0') { alert('Please select a city.'); return; }

        if (!agreeTerms) { alert('Please agree to the Terms of Use and Privacy Policy.'); return; }

        if(checkIfValueIsCorrect(getUserUUID())) {
            updateUserProfileToServer(getUserUUID(), name, mobile, classId, streamId, boardId, stateId, cityId, '', '')
                .then(function(data) {
                    $('.completeprofileform').addClass('hideThis');
                    // alert('Profile Updated Successfully.');

                    if(
                        checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhone')) &&
                        !checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhoneVerified'))
                    ) {
                        isMobileVerifyOrLogin = 3; //embededPopup
                        generateOTP(null, 1);
                    }
                })
                .catch(function(error) {
                    console.log('Error:', error.message);
                    alert('Error in updaing Profile data ' + error.message);
                });
        }
    });

    $(document).ready(function() {


        var userClassId = getDataFromLocalStorage('selfstudyUserClassId');
        if(checkIfValueIsCorrect(getUserUUID()) && checkIfValueIsCorrect(userClassId)) {
            var primeEligibleClassIds = [2,14,15,18,21,24,34,35,36,37];
            userClassId = Number(userClassId);
            if(primeEligibleClassIds.includes(userClassId)) {
                $('.primeFeatureBox').removeClass('hideThis');
                var userPhoneVerified = getDataFromLocalStorage('selfstudyUserPhoneVerified');
                if(checkIfValueIsCorrect(userPhoneVerified)) {
                    $('.primeBtnGreen').removeClass('hideThis');
                    $('#primeFeaturePdfBox').addClass('hideThis');
                } else {
                    $('.applyToPrimeBtn, .primePageApplyNowBox, .primeBtnRed').removeClass('hideThis');
                }
            }
        }

        getProfileBasicData()
            .then(function(basic_data) {
                // console.log('basic_data', basic_data);

                $.each(basic_data.data.class_exams, function(index, item) {
                    if(item.parent_id == 1) {
                        $('#userDetailsPopupClass').append(createSelectBoxItem(item.title, item.id, 'classItem'));
                    }
                });

                $.each(basic_data.data.boards, function(index, item) {
                    $('#userDetailsPopupBoard').append(createSelectBoxItem(item.title, item.id, 'boardItem'));
                });

                $.each(basic_data.data.states, function(index, item) {
                    $('#userDetailsPopupState').append(createSelectBoxItem(item.title, item.id, 'stateItem'));
                });

                //Field Filter Options
                $('#classInputField').on('keyup', function() {
                    let searchTerm = $(this).val();
                    filterDropdown($('.classItem'), searchTerm);
                });
                $('#streamInputField').on('keyup', function() {
                    let searchTerm = $(this).val();
                    filterDropdown($('.streamItem'), searchTerm);
                });
                $('#boardInputField').on('keyup', function() {
                    let searchTerm = $(this).val();
                    filterDropdown($('.boardItem'), searchTerm);
                });
                $('#stateInputField').on('keyup', function() {
                    let searchTerm = $(this).val();
                    filterDropdown($('.stateItem'), searchTerm);
                });
                $('#cityInputField').on('keyup', function() {
                    let searchTerm = $(this).val();
                    filterDropdown($('.cityItem'), searchTerm);
                });
                function filterDropdown($items, searchTerm) {
                    $items.each(function() {
                        let text = $(this).text().toLowerCase();
                        searchTerm = searchTerm.toLowerCase();
                        $(this).toggle(text.includes(searchTerm));
                    });
                }

                //Field Option Clicks
                $(document).on('click', '.classItem', function() {
                    selectedClassId = $(this).data('value');
                    userProfileClass = $(this).html();
                    updateSelectedLabel('.classDropdown', userProfileClass);

                    saveUserProfileData(1);

                    $('#userDetailsPopupStream').html('');
                    updateSelectedLabel('.streamDropdown', 'Select Stream');
                    $('#udStreamFormGroup').addClass('hideThis');
                    selectedStreamId = 0;

                    let streamItems = basic_data.data.class_exams.filter(item => item.parent_id == selectedClassId);
                    if(streamItems.length > 0) {

                        $.each(streamItems, function(index, item) {
                            $('#userDetailsPopupStream').append(createSelectBoxItem(item.title, item.id, 'streamItem'));
                        });

                        $('#udStreamFormGroup').removeClass('hideThis');
                    }

                    $('#udBoardFormGroup').removeClass('hideThis');
                    $('#udStateFormGroup').removeClass('hideThis');
                    $('#udCityFormGroup').removeClass('hideThis');
                });
                $(document).on('click', '.streamItem', function() {
                    selectedStreamId = $(this).data('value');
                    userProfileStream = $(this).html();
                    updateSelectedLabel('.streamDropdown', userProfileStream);
                });
                $(document).on('click', '.boardItem', function() {
                    selectedBoardId = $(this).data('value');
                    userProfileBoard = $(this).html();
                    updateSelectedLabel('.boardDropdown', userProfileBoard);
                });
                $(document).on('click', '.stateItem', function() {
                    selectedStateId = $(this).data('value');
                    userProfileState = $(this).html();
                    updateSelectedLabel('.stateDropdown', userProfileState);

                    $('#userDetailsPopupCity').html('');
                    updateSelectedLabel('.cityDropdown', 'Select City');
                    selectedCityId = 0;

                    let cityItems = basic_data.data.cities.filter(item => item.parent_id == selectedStateId);
                    $.each(cityItems, function(index, item) {
                        $('#userDetailsPopupCity').append(createSelectBoxItem(item.title, item.id, 'cityItem'));
                    });
                });
                $(document).on('click', '.cityItem', function() {
                    selectedCityId = $(this).data('value');
                    userProfileCity = $(this).html();
                    updateSelectedLabel('.cityDropdown', userProfileCity);
                });
                function updateSelectedLabel(selector, value) {
                    $(selector).find('.dropdown-toggle').html(value);
                }

                const userStateId = getDataFromLocalStorage('selfstudyUserStateId');
                if(checkIfValueIsCorrect(userStateId)) {
                    getSetIntrnlCampOnThisPage(false);
                } else {
                    getLocationByIpAddress()
                        .then(function(locationData) {
                            if(locationData.countryCode == 'IN') {
                                var isStateFound = 0;
                                searchAndFindStateId(basic_data.data.states, locationData.regionName)
                                    .then(foundStateId => {
                                        return searchAndFindCityId(basic_data.data.cities, locationData.city, foundStateId)
                                            .then(foundCityId => { return { stateId: foundStateId, cityId: foundCityId }; })
                                            .catch(() => { return { stateId: foundStateId, cityId: 0 }; });
                                    })
                                    .then(ids => {

                                        let payload = { 'state_id': ids.stateId,'city_id': ids.cityId,'state_name': locationData.regionName, 'city_name': locationData.city }

                                        if(checkIfValueIsCorrect(getUserUUID())) {
                                            performPOSTRequest("https://topcoaching.in/api/save-user-state-and-city-id", payload, true)
                                                .then(function(serverStateCityData) {
                                                    if(serverStateCityData.status == "success" && serverStateCityData.data.status == 1) {
                                                        let sStateId = serverStateCityData.data.state_id;
                                                        let sCityId = null;
                                                        if(serverStateCityData.data.city_id > 0) {
                                                            sCityId = serverStateCityData.data.city_id;
                                                        }
                                                        saveUserProfileInfoToLocalStorage(null, null, null, null, null, null, sStateId, sCityId, null,null);
                                                        getSetIntrnlCampOnThisPage(true);
                                                    } else {
                                                        saveUserProfileInfoToLocalStorage(null, null, null, null, null, null, ids.stateId, ids.cityId, null,null);
                                                        getSetIntrnlCampOnThisPage(false);
                                                    }
                                                })
                                                .catch(function(error) {
                                                    saveUserProfileInfoToLocalStorage(null, null, null, null, null, null, ids.stateId, ids.cityId, null,null);
                                                    getSetIntrnlCampOnThisPage(false);
                                                    console.log('Error:', error);
                                                });
                                        } else {
                                            saveUserProfileInfoToLocalStorage(null, null, null, null, null, null, ids.stateId, ids.cityId, null,null);
                                            getSetIntrnlCampOnThisPage(false);
                                        }
                                    })
                                    .catch(error => {
                                        console.error(error);
                                        getSetIntrnlCampOnThisPage(false);
                                        let payload = { 'search_find_state_id': error };
                                        performGETRequest("https://topcoaching.in/api/log-seflstudy-web-error", payload, false);
                                    });
                            } else {
                                // console.log('OutsideIndia');
                                getSetIntrnlCampOnThisPage(false);
                            }
                        })
                        .catch(function(error) {
                            getSetIntrnlCampOnThisPage(false);
                            let payload = { 'get_location_by_ip_address': error };
                            performGETRequest("https://topcoaching.in/api/log-seflstudy-web-error", payload, false);
                        });
                }
            })
            .catch(function(error) {
                getSetIntrnlCampOnThisPage(false);
                console.log('Error2:', error);
            });

        function searchAndFindStateId(states, stateName) {
            if(stateName == 'National Capital Territory of Delhi') { stateName = 'Delhi'; }
            return new Promise((resolve, reject) => {
                stateName = convertUnicodeToString(stateName);
                const foundState = states.find(state => state.title === stateName);
                if (foundState) {
                    resolve(foundState.id);
                } else {
                    // console.log('stateName: ' + stateName);
                    reject("State not found: " + stateName);
                }
            });
        }

        function searchAndFindCityId(cities, cityName, stateId) {
            return new Promise((resolve, reject) => {
                cityName = convertUnicodeToString(cityName);
                const city = cities
                    .filter(item => item.parent_id === stateId)
                    .find(item => item.title === cityName);

                if (city && city.id) {
                    resolve(city.id);
                } else {
                    reject(new Error(`City "${cityName}" not found in state with ID ${stateId}`));
                }
            });
        }

        if ($('div.completeprofileform').length > 0) {
            if(checkIfValueIsCorrect(getUserUUID())) {
                let needToShowForm = false;

                const cpfClassId    = getDataFromLocalStorage('selfstudyUserClassId');
                const cpfStreamId   = getDataFromLocalStorage('selfstudyUserStreamId');
                const cpfBoardId    = getDataFromLocalStorage('selfstudyUserBoardId');
                const cpfStateId    = getDataFromLocalStorage('selfstudyUserStateId');
                const cpfCityId     = getDataFromLocalStorage('selfstudyUserCityId');

                // console.log('cpfClassId: ' + cpfClassId);
                // console.log('cpfStreamId: ' + cpfStreamId);
                // console.log('cpfBoardId: ' + cpfBoardId);
                // console.log('cpfStateId: ' + cpfStateId);
                // console.log('cpfCityId: ' + cpfCityId);

                getProfileBasicData()
                    .then(function(basic_data) {
                        $('#cpfClass').on('change', function() {
                            var selectedClassId = $(this).val();

                            $('#cpfStream').html('<option id="0">Select Stream</option>');
                            let cpfStreamItems2 = basic_data.data.class_exams.filter(item => item.parent_id == selectedClassId);

                            if(cpfStreamItems2.length > 0) {
                                $.each(cpfStreamItems2, function(index, item) {
                                    $('#cpfStream').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, false));
                                });
                                $('#cpfStreamDiv').removeClass('hideThis');
                            } else {
                                $('#cpfStreamDiv').addClass('hideThis');
                            }
                        });

                        $('#cpfState').on('change', function() {
                            var selectedStateId = $(this).val();

                            $('#cpfCity').html('<option id="0">Select City</option>');
                            let cpfCityItems2 = basic_data.data.cities.filter(item => item.parent_id == selectedStateId);

                            if(cpfCityItems2.length > 0) {
                                $.each(cpfCityItems2, function(index, item) {
                                    $('#cpfCity').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, false));
                                });
                                $('#cpfCityDiv').removeClass('hideThis');
                            } else {
                                $('#cpfCityDiv').addClass('hideThis');
                            }
                        });

                        if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserDisplayName'))) {
                            $('#cpfName').val(getDataFromLocalStorage('selfstudyUserDisplayName'));
                        }

                        if(!checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyUserPhone'))) {
                            $('#cpfMobileDiv').removeClass('hideThis');
                            needToShowForm = true;
                        }

                        if( !checkIfValueIsCorrect(cpfClassId) || !checkIfValueIsCorrect(cpfStreamId) || cpfClassId == 0 || cpfStreamId == 0 ) {

                            if( checkIfValueIsCorrect(cpfClassId) && cpfClassId > 2 && cpfClassId < 13 ) {
                                //No need to show class,stream
                            } else {
                                $.each(basic_data.data.class_exams, function(index, item) {
                                    if(item.parent_id == 1) {
                                        if(item.id == cpfClassId) { var isSelected = true; } else { var isSelected = false; }
                                        $('#cpfClass').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, isSelected));
                                    }
                                });

                                if(cpfClassId > 0) {
                                    let cpfStreamItems = basic_data.data.class_exams.filter(item => item.parent_id == cpfClassId);
                                    $.each(cpfStreamItems, function(index, item) {
                                        if(item.id == cpfStreamId) { var isSelected = true; } else { var isSelected = false; }
                                        $('#cpfStream').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, isSelected));
                                    });
                                }

                                $('#cpfClassDiv, #cpfStreamDiv').removeClass('hideThis');
                                needToShowForm = true;
                            }
                        }

                        if( !checkIfValueIsCorrect(cpfStateId) || !checkIfValueIsCorrect(cpfCityId) || cpfStateId == 0 || cpfCityId == 0 ) {
                            $.each(basic_data.data.states, function(index, item) {
                                if(item.id == cpfStateId) { var isSelected = true; } else { var isSelected = false; }
                                $('#cpfState').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, isSelected));
                            });

                            if(cpfStateId > 0) {
                                let cpfCityItems = basic_data.data.cities.filter(item => item.parent_id == cpfStateId);
                                $.each(cpfCityItems, function(index, item) {
                                    if(item.id == cpfCityId) { var isSelected = true; } else { var isSelected = false; }
                                    $('#cpfCity').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, isSelected));
                                });
                            }

                            $('#cpfStateDiv, #cpfCityDiv').removeClass('hideThis');
                            needToShowForm = true;
                        }

                        if( !checkIfValueIsCorrect(cpfBoardId) || cpfBoardId == 0 ) {
                            $.each(basic_data.data.boards, function(index, item) {
                                if(item.id == cpfBoardId) { var isSelected = true; } else { var isSelected = false; }
                                $('#cpfBoard').append(createSelectBoxItemCompleteProfileForm(item.id, item.title, isSelected));
                            });

                            $('#cpfBoardDiv').removeClass('hideThis');
                            needToShowForm = true;
                        }

                        if(needToShowForm) {
                            $('#cpfNameDiv').removeClass('hideThis');
                            $('.completeprofileform').removeClass('hideThis');
                        }
                    })
                    .catch(function(error) {
                        console.log('Error:', error);
                    });
            }
        }

        $('#loginMobileNumber').val(getDataFromLocalStorage('selfstudyUserPhone'));

        $('#totp1').on('input', function() {
            var val = $(this).val();
            if ($.isNumeric(val)) {
                $('#totp2').focus();
            } else {
                $(this).val('');
            }
        });

        $('#totp2').on('input', function() {
            var val = $(this).val();
            if ($.isNumeric(val)) {
                $('#totp3').focus();
            } else {
                $(this).val('');
            }
        });

        $('#totp3').on('input', function() {
            var val = $(this).val();
            if ($.isNumeric(val)) {
                $('#totp4').focus();
            } else {
                $(this).val('');
            }
        });

        $('#totp4').on('input', function() {
            var val = $(this).val();
            if ($.isNumeric(val)) {
                $('#loginVerifyOTP').click();
            } else {
                $(this).val('');
            }
        });

        //RemoveThisIfConditionWhenNewLoginFullyRollout
        // if(checkIfValueIsCorrect(getDataFromLocalStorage('selfstudyFirebaseToken')) && !checkIfValueIsCorrect(getUserUUID())) {
        //     logoutUser(0);
        // }

        if (window.innerWidth <= 767) {
            if(checkIfValueIsCorrect(getUserUUID())) {
                var totalPerc = setAndGetProfileComplitionPercentage();

                if(totalPerc < 100) {
                    $('#complete-profile-bottom-link').attr('href', '/user/profile-edit');
                    $('#user-profile-completed-footer').removeClass('hideThis');
                }
            } else {
                $('#complete-profile-bottom-link').addClass('showSignupPopup');
                $('#user-profile-completed-footer').removeClass('hideThis');
            }
        }

        Object.keys(dailyClickKeyConfig).forEach(function(keyPrefix) {
            if(!checkIfValueIsCorrect(getUserUUID())) {
                $('.' + dailyClickKeyConfig[keyPrefix]).on('click', function(event) {
                    event.preventDefault();
                    let link = $(this);

                    incrementDailyClickCount(keyPrefix, function(clickCount) {
                        if (clickCount < 4) {
                            window.open(link.attr('href'), '_blank');
                        } else {
                            if(!checkIfValueIsCorrect(getUserUUID())) {
                                loginSource = keyPrefix;
                                if(loginSource == 'pdfclicks') {
                                    $('#signuppopupHeaderTitle').html('Unlock FREE Unlimited Access with a Login!');
                                    saveDataToLocalStorage('loginsource', 'gotopdfdownloadpage');
                                }
                                $('#modalLogin').modal('show');
                            } else {
                                window.open(link.attr('href'), '_blank');
                            }
                        }
                    });
                });
            }
        });

    });
</script>
</body>
</html>